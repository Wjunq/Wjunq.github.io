<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    <meta name="description" content="Hexo Theme Redefine">
    <meta name="author" content="June">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-redefine.png">
    
    <!--- Seo Part-->
    
    <link rel="canonical" href="http://example.com/2023/05/03/node/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    <meta property="og:type" content="article">
    <meta property="og:title" content="node">
    <meta property="og:description" content="Hexo Theme Redefine">
    <meta property="og:url" content="http://example.com2023/05/03/node/">
    
    <meta property="og:site_name" content="我的微博">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="node">
    <meta name="twitter:description" content="Hexo Theme Redefine">
    <meta name="twitter:image" content="/images/redefine-logo.svg">
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/redefine-logo.svg" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/redefine-logo.svg">
    <meta name="theme-color" content="#005080">
    <link rel="shortcut icon" href="/images/redefine-logo.svg">
    
    <title>
        
            node -
        
        我的微博
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
<link rel="stylesheet" href="/assets/fonts.css">

    
    
    
    <script id="hexo-configurations">
    let REDEFINE = window.REDEFINE || {};
    REDEFINE.hexo_config = {"hostname":"example.com","root":"/","language":"en"};
    REDEFINE.theme_config = {"toc":{"enable":true,"number":false,"expand_all":true,"init_open":true},"style":{"primary_color":"#005080","avatar":"/images/redefine-avatar.svg","favicon":"/images/redefine-logo.svg","og_image":{"enable":false,"image_url":null},"article_img_align":"center","right_side_width":"210px","content_max_width":"1000px","nav_color":{"left":"#f78736","right":"#367df7","transparency":35},"hover":{"shadow":true,"scale":false},"first_screen":{"enable":true,"background_image":{"light":"/images/wallhaven-wqery6-light.webp","dark":"/images/wallhaven-wqery6-dark.webp"},"title_color":{"light":"#fff","dark":"#d1d1b6"},"font_sizes":{"title":"2.8rem","subtitle":"1.5rem"},"line_height":1.2,"title":"Theme Redefine","subtitle":{"enable":false,"list":[]},"custom_font":{"enable":false,"font_family":null,"font_url":null}},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":false}}},"local_search":{"enable":false,"preload":true},"code_block":{"copy":true,"style":"mac","custom_font":{"enable":false,"font_family":null,"font_url":null}},"pjax":{"enable":true},"lazyload":{"enable":true},"version":"1.2.1","friend_links":{"columns":2},"home_article":{"date_format":"YYYY-MM-DD","category":{"enable":true,"limit":3},"tag":{"enable":true,"limit":3}},"plugins":{"aplayer":{"enable":false,"audio":[{"name":null,"artist":null,"url":null,"cover":null},{"name":null,"artist":null,"url":null,"cover":null}]},"mermaid":{"enable":false,"version":"9.3.0"}}};
    REDEFINE.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
  </script>
    
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
    
    
    
<meta name="generator" content="Hexo 5.4.2"></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fa-solid fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="menu-wrapper">
    
    <div class="menu-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                
                我的微博
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="pc">
                <ul class="menu-list">
                    
                        
                            <li class="menu-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/"  >
                                    
                                        
                                            <i class="fa-regular fa-house"></i>
                                        
                                        HOME
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile drawer -->
    <div class="menu-drawer">
        <ul class="drawer-menu-list">
            
                
                    <li class="drawer-menu-item flex-center">
                        <a class="" 
                        href="/"  >
                             
                                
                                    <i class="fa-regular fa-house"></i>
                                
                                HOME
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            

        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="post-page-container">
        <div class="article-content-container">

            
            
                <div class="article-title">
                    <h1 class="article-title-regular">node</h1>
                </div>
            
                
            

            
                <div class="article-header">
                    <div class="avatar">
                        <img src="/images/redefine-avatar.svg">
                    </div>
                    <div class="info">
                        <div class="author">
                            <span class="name">June</span>
                            
                                <span class="author-label">lol</span>
                            
                        </div>
                        <div class="meta-info">
                            <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="pc">2023-05-03 20:59:11</span>
        <span class="mobile">2023-05-03 20:59</span>
        <span class="hover-info">Created</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="pc">2023-07-03 21:07:49</span>
            <span class="mobile">2023-07-03 21:07</span>
            <span class="hover-info">Updated</span>
        </span>
    

    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/nodeJS%E5%9F%BA%E6%9C%AC%E5%86%85%E5%AE%B9/">nodeJS基本内容</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                        </div>
                    </div>
                </div>
            

            <div class="article-content markdown-body">
                <h1 id="nodeJs"><a href="#nodeJs" class="headerlink" title="nodeJs"></a>nodeJs</h1><h2 id="初识nodeJs"><a href="#初识nodeJs" class="headerlink" title="初识nodeJs"></a>初识nodeJs</h2><blockquote>
<p>Node.js@ is a JavaScript runtime built on Chrome’s V8 JavaScript engine.Node.js </p>
<p>是一个基于 Chrome V8引的JavaScript 运行环境</p>
</blockquote>
<p><strong>js在浏览器中运行证明是前端开发，js放在node中运行就是后端开发</strong></p>
<p>Node.js 的官网地址: <a class="link"   target="_blank" rel="noopener" href="https://nodejs.org/en" >Node.js (nodejs.org) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h3 id="nodeJs中的js运行"><a href="#nodeJs中的js运行" class="headerlink" title="nodeJs中的js运行"></a>nodeJs中的js运行</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src=".%5Cpic%5Cnode%E5%9C%A8js%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83.png"
                      alt="node在js运行环境"
                ></p>
<ul>
<li>浏览器是JavaScript 的前端运行环境</li>
<li>Node.js 是JavaScript 的后端运行环境</li>
<li>Node.js 中无法调用 DOM 和 BOM等浏览器内置 API</li>
</ul>
<h3 id="nodeJs可以做什么"><a href="#nodeJs可以做什么" class="headerlink" title="nodeJs可以做什么"></a>nodeJs可以做什么</h3><blockquote>
<p>Nodejs 作为一个JavaScript 的运行环境，仅仅提供了基础的功能和 AP。然而，基于 Node.js 提供的这些基础能，很多强大的工具和框架如雨后春笋，层出不穷，所以学会了 Node.js，可以让前端程序员胜任更多的工作和岗位:</p>
</blockquote>
<ul>
<li>基于Express 框架(<a class="link"   target="_blank" rel="noopener" href="http://www.expressjs.com.cn/)%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%BF%AB%E9%80%9F%E6%9E%84%E5%BB%BA" >http://www.expressjs.com.cn/)，可以快速构建 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> Web 应用</li>
<li>基于Electron框架(<a class="link"   target="_blank" rel="noopener" href="https://electronjs.org/)%EF%BC%8C%E5%8F%AF%E4%BB%A5%E6%9E%84%E5%BB%BA%E8%B7%A8%E5%B9%B3%E5%8F%B0%E7%9A%84%E6%A1%8C%E9%9D%A2%E5%BA%94%E7%94%A8" >https://electronjs.org/)，可以构建跨平台的桌面应用 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
<li>基于restify 框架(<a class="link"   target="_blank" rel="noopener" href="http://restify.com/)%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%BF%AB%E9%80%9F%E6%9E%84%E5%BB%BAAPI" >http://restify.com/)，可以快速构建API <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> 接口项目</li>
<li>读写和操作数据库、创建实用的命令行工具辅助前端开发、etc…</li>
</ul>
<p><em>Node,js 的学习路径:<br>JavaScript 基础语法 + Nodejs 内置 API 模块 (fs、 path http等) + 第=方 API 模块 (express、 mysql等)</em></p>
<h3 id="下载nodeJs"><a href="#下载nodeJs" class="headerlink" title="下载nodeJs"></a>下载nodeJs</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src=".%5Cpic%5C%E4%B8%8B%E8%BD%BDnode.png"
                      alt="下载node"
                ></p>
<p>然后安装</p>
<h4 id="区分LTS和Current版本的不同"><a href="#区分LTS和Current版本的不同" class="headerlink" title="区分LTS和Current版本的不同"></a>区分LTS和Current版本的不同</h4><ul>
<li>LTS为长期稳定版，对于追求稳定性的企业级项目来说，推荐安装LTS版本的Node.js</li>
<li>Current 为新特性尝鲜版，对热衷于尝试新特性的用户来说，推荐安装 Current 版本的 Node.js。但是，Current 版本中可2能存在隐藏的Bug 或安全性漏洞因此不推荐在企业级项目中使用Current 版本的Nodejs</li>
</ul>
<h4 id="查看node版本"><a href="#查看node版本" class="headerlink" title="查看node版本"></a>查看node版本</h4><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br></pre></td></tr></table></figure></div>

<h4 id="nodeJ运行JS代码"><a href="#nodeJ运行JS代码" class="headerlink" title="nodeJ运行JS代码"></a>nodeJ运行JS代码</h4><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node js文件</span><br></pre></td></tr></table></figure></div>

<h2 id="fs模块"><a href="#fs模块" class="headerlink" title="fs模块"></a>fs模块</h2><blockquote>
<p>fs 模块是 ode.js 官方提供的、用来操作文件的模块。它提供了一系列的方法和属性，用来满足用户对文件的操作需求.</p>
</blockquote>
<ul>
<li>fs.readFile0 方法，用来读取指定文件中的内容</li>
<li>fs.writeFile0 方法，用来向指定的文件中写入内容</li>
</ul>
<h3 id="fs-readFile"><a href="#fs-readFile" class="headerlink" title="fs.readFile"></a>fs.readFile</h3><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.<span class="title function_">readFile</span>(path,[，options],callback)</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>参数1:必选参数，字符串，表示文件的路径</p>
</li>
<li><p>参数2:可选参数，表示以什么编码格式来读取文件</p>
</li>
<li><p>参数3:必选参数，文件读取完成后，通过回调函数拿到读取的结果</p>
</li>
</ul>
<blockquote>
<p>示例代码</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span> )</span><br><span class="line">fs.<span class="title function_">readFile</span>(<span class="string">&#x27;/files/11.txt&#x27;</span>,<span class="string">&#x27;utf8&#x27;</span>,<span class="keyword">function</span>(<span class="params">edataStr</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;-----&#x27;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(dataStr)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入模块</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="comment">//  2.调用 fs.readFile() 方法读取文件</span></span><br><span class="line"><span class="comment">// 参数1: 读取文件的存放路径</span></span><br><span class="line"><span class="comment">// 参数2: 读取文件时候采用的编码格式，一般默认指定 utf8</span></span><br><span class="line"><span class="comment">// 参数3: 回调函数，拿到读取失败和成功的结果err dataStr</span></span><br><span class="line">fs.<span class="title function_">readFile</span>(<span class="string">&#x27;./read.tex&#x27;</span>,<span class="string">&#x27;utf-8&#x27;</span>,<span class="keyword">function</span>(<span class="params">err,dataStr</span>)&#123;</span><br><span class="line">    <span class="comment">// 如果读取失败了 则err为null</span></span><br><span class="line">    <span class="comment">// 读取失败则err的值为 错误对象，dataStr的值为undefined</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(dataStr)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<h4 id="判断文件是否读取成功"><a href="#判断文件是否读取成功" class="headerlink" title="判断文件是否读取成功"></a>判断文件是否读取成功</h4><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入模块</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line">fs.<span class="title function_">readFile</span>(<span class="string">&#x27;./rea.tex&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>, <span class="keyword">function</span> (<span class="params">err, dataStr</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;文件读取失败&quot;</span> + err);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(dataStr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<h3 id="fs-writeFile"><a href="#fs-writeFile" class="headerlink" title="fs.writeFile"></a>fs.writeFile</h3><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.<span class="title function_">writeFile</span>(feil,[，options],callback)</span><br></pre></td></tr></table></figure></div>
<ul>
<li><p>参数1:必选参数，需要指定一个文件路径的字符串，表示文件的存放路径</p>
</li>
<li><p>参数2:必选参数，表示要写入的内容</p>
</li>
<li><p>参数3:可选参数，表示以什么格式写入文件内容，默认值是utf8</p>
</li>
<li><p>参数4:必选参数，文件写入完成后的回调函数</p>
</li>
</ul>
<blockquote>
<p>示例代码</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line">fs.<span class="title function_">writeFile</span>(<span class="string">&#x27;./files/2.txt&#x27;</span>, <span class="string">&#x27;Hello Node.js!&#x27;</span>, <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入fs模块</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="comment">// 写入文件方法</span></span><br><span class="line"><span class="comment">// 2.调用 fs.writeFile() 方法，写入文件的内容</span></span><br><span class="line"><span class="comment">// 参数1: 表示文件的存放路径</span></span><br><span class="line"><span class="comment">// 参数2: 表示要写入的内容</span></span><br><span class="line"><span class="comment">// 参数3: 回调函数</span></span><br><span class="line">fs.<span class="title function_">writeFile</span>(<span class="string">&quot;./feil/read1.tex&quot;</span>,<span class="string">&#x27;hello你好&#x27;</span>,<span class="keyword">function</span>(<span class="params">err</span>)&#123;</span><br><span class="line">    <span class="comment">// 如果写入成功，则err为null</span></span><br><span class="line">    <span class="comment">// 如果文件写入失败,则err等于一个 错误对象</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>
<h4 id="判断文件是否读取成功-1"><a href="#判断文件是否读取成功-1" class="headerlink" title="判断文件是否读取成功"></a>判断文件是否读取成功</h4><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入模块</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line">fs.<span class="title function_">writeFile</span>(<span class="string">&quot;./feil/read1.tex&quot;</span>,<span class="string">&#x27;hello你好&#x27;</span>,<span class="keyword">function</span>(<span class="params">err</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(err)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;文件写入失败&quot;</span> + err.<span class="property">message</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;文件写入成功&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<h3 id="整理考试成绩"><a href="#整理考试成绩" class="headerlink" title="整理考试成绩"></a>整理考试成绩</h3><p>核心实现步骤</p>
<ul>
<li><p>导入需要的 fs文件系统模块</p>
</li>
<li><p>使用 fs.readFile()方法，读取素材目录下的 成绩.txt 文件</p>
</li>
<li><p>判断文件是否读取失败</p>
</li>
<li><p>文件读取成功后，处理成绩数据</p>
</li>
<li><p>将处理完成的成绩数据，调用 fs.writeFile()方法，写入到新文件成绩-ok.txt 中</p>
</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line">fs.<span class="title function_">readFile</span>(<span class="string">&#x27;./feil/成绩.tex&#x27;</span>,<span class="string">&#x27;utf-8&#x27;</span>,<span class="keyword">function</span>(<span class="params">err,dataStr</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(err)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;文件读取失败&quot;</span> + err);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 先把成绩的数据,安装空格进行分割</span></span><br><span class="line">    <span class="keyword">const</span> arrOld = dataStr.<span class="title function_">split</span>(<span class="string">&quot; &quot;</span>);</span><br><span class="line">    <span class="comment">// 循环分割后的数组,对每一个数据进行字符串的替换操作</span></span><br><span class="line">    <span class="keyword">const</span> arrNew = [];</span><br><span class="line">    arrOld.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        arrNew.<span class="title function_">push</span>(item.<span class="title function_">replace</span>(<span class="string">&#x27;=&#x27;</span>,<span class="string">&quot;:&quot;</span>))</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 新数组的每一个,进行合并,得到一个新的字符串</span></span><br><span class="line">    <span class="keyword">const</span> newStr = arrNew.<span class="title function_">join</span>(<span class="string">&#x27;\r\n&#x27;</span>);</span><br><span class="line">    fs.<span class="title function_">writeFile</span>(<span class="string">&#x27;./feil/成绩-ok.tex&#x27;</span>,newStr,<span class="keyword">function</span>(<span class="params">err</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(err)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;文件写入失败&quot;</span> + err.<span class="property">message</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;文件写入成功&quot;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>


<h3 id="fs路径动态拼接的问题"><a href="#fs路径动态拼接的问题" class="headerlink" title="fs路径动态拼接的问题"></a>fs路径动态拼接的问题</h3><blockquote>
<p>在使用s 模块操作文件时，如果提供的操作路径是以../或./开头的相对路径时，很容易出现路径动态拼接错误的问题，</p>
</blockquote>
<p><strong>原因:代码在运行的时候，会以执行 node 命令时所处的目录，动态拼接出被操作文件的完整路径</strong></p>
<ol>
<li><p>可以提供一个完整的文件路径,移植性非常差,不利于后期的维护</p>
</li>
<li><p>使用__dirname,表示当前文件的所处目录</p>
 <div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="comment">// 表示当前所处的目录</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(__dirname)</span><br><span class="line"></span><br><span class="line">fs.<span class="title function_">readFile</span>(__dirname + <span class="string">&quot;/feil/成绩.tex&quot;</span>,<span class="string">&#x27;utf-8&#x27;</span>,<span class="keyword">function</span>(<span class="params">err,dataStr</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(err)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;文件读取失败&quot;</span> + err.<span class="property">message</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;文件读取成功&#x27;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(dataStr)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div></li>
<li><p>使用path模块解决</p>
</li>
</ol>
<h2 id="path模块"><a href="#path模块" class="headerlink" title="path模块"></a>path模块</h2><blockquote>
<p>path 模块是 Node.js 官方提供的、用来处理路径的模块。它提供了一系列的方法和属性，用来满足用户对路径的处理需求。<br>例如:</p>
</blockquote>
<ul>
<li><p>path.join0 方法，用来将多个路径片段拼接成一个完整的路径字符串</p>
</li>
<li><p>path.basename0 方法，用来从路径字符串中，将文件名解析出来</p>
</li>
</ul>
<p>如果要在JavaScript代码中，使用 path 模块来处理路径，则需要使用如下的方式先导入它</p>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br></pre></td></tr></table></figure></div>

<h3 id="path-join"><a href="#path-join" class="headerlink" title="path.join()"></a>path.join()</h3><blockquote>
<p>使用 path.join()方法，可以把多个路径片段拼接为完整的路径字符串，语法格式如下:</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path.<span class="title function_">join</span>([...paths])</span><br></pre></td></tr></table></figure></div>

<p>参数解读:</p>
<ul>
<li>…paths<string>路径片段的序列</li>
<li>返回值: <string></li>
</ul>
<blockquote>
<p>示例代码</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pathStr = path.<span class="title function_">join</span>(<span class="string">&#x27;/a&#x27;</span>,<span class="string">&#x27; /b/c&#x27;</span>,<span class="string">&#x27;../&#x27;</span>,<span class="string">&#x27;/d&#x27;</span>,<span class="string">&#x27;/e&#x27;</span>)</span><br><span class="line"><span class="comment">// ../会将前面的一层路径抵消掉</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(pathStr) <span class="comment">// 输出  a\bid\e</span></span><br><span class="line"><span class="keyword">const</span> pathStr2 = path.<span class="title function_">join</span>(__dirname,<span class="string">&#x27;./files/1 .txt&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(pathStr2) <span class="comment">// 输出 当前文件所处目录 \files\1.txt</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> pathStr = path.<span class="title function_">join</span>(<span class="string">&#x27;/e&#x27;</span>,<span class="string">&#x27;/d/e/c&#x27;</span>,<span class="string">&#x27;../&#x27;</span>,<span class="string">&#x27;/e&#x27;</span>,<span class="string">&#x27;./&#x27;</span>,<span class="string">&#x27;e&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(pathStr)  <span class="comment">// \e\d\e\e\e</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p><strong><font color='red'>今后涉及到路径的拼接的操作,都要使用path.join()方法进行处理,不要直接使用 + 进行字符串拼接</font></strong></p>
<h3 id="path-basename"><a href="#path-basename" class="headerlink" title="path.basename()"></a>path.basename()</h3><blockquote>
<p>使用 path.basename方法，可以获取路径中的最后一部分，经常通过这个方法获取路径中的文件名</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path.<span class="title function_">basename</span>(path[,ext])</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>path<string>必选参数，表示一个路径的字符串</p>
</li>
<li><p>ext<string>可选参数，表示文件扩展名</p>
</li>
<li><p>返回:<string>表示路径中的最后一部分</p>
</li>
</ul>
<blockquote>
<p>示例代码</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fpath =<span class="string">&#x27;/a/b/c/index.htm&#x27;</span> <span class="comment">// 文件的存放路径</span></span><br><span class="line"><span class="keyword">var</span> fullName = path.<span class="title function_">basename</span>(fpath)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(fullName) <span class="comment">// 输出 index.html</span></span><br><span class="line"><span class="keyword">var</span> nameWithoutExt = path.<span class="title function_">basename</span>(fpath,<span class="string">&#x27;.html&#x27;</span> )</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(nameWithoutExt) <span class="comment">// 输出 index</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fpath = <span class="string">&#x27;/a/b/c/index.html&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> fullNname = path.<span class="title function_">basename</span>(fpath);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(fullNname) <span class="comment">// index.html</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fullNnameEnd = path.<span class="title function_">basename</span>(fpath,<span class="string">&#x27;.html&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(fullNnameEnd); <span class="comment">// index</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h3 id="path-extname"><a href="#path-extname" class="headerlink" title="path.extname()"></a>path.extname()</h3><blockquote>
<p>使用 path.extname方法，可以获取路径中的扩展名部分，语法格式如下</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path.<span class="title function_">extname</span>(path)</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>path<string>必选参数，表示一个路径的字符串</p>
</li>
<li><p>返回:<string>返回得到的扩展名字符串</p>
</li>
</ul>
<blockquote>
<p>示例代码</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fpath = <span class="string">&#x27;/a/b/c/index.html&#x27;</span> <span class="comment">//.</span></span><br><span class="line">路径字符串</span><br><span class="line"><span class="keyword">const</span> fext = path.<span class="title function_">extname</span>(fpath)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(fext) <span class="comment">// 输出 .html</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fpath = <span class="string">&#x27;a/a/b/ac/index.js&#x27;</span></span><br><span class="line"><span class="keyword">const</span> fext = path.<span class="title function_">extname</span>(fpath)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(fext) <span class="comment">// .js</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h3 id="path路径案例"><a href="#path路径案例" class="headerlink" title="path路径案例"></a>path路径案例</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src=".%5Cpic%5C%E6%97%B6%E9%92%9F.png"
                      alt="时钟案例"
                ></p>
<div class="highlight-container" data-rel="Tex"><figure class="iseeu highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">将素材目录下的index.html页面拆分成三个文件，分别是:</span><br><span class="line">    index.css</span><br><span class="line">    indexjs</span><br><span class="line">    index.html</span><br><span class="line">并且将拆分出来的3个文件，存放到 clock 目录中。</span><br></pre></td></tr></table></figure></div>

<h4 id="案例的实现步骤"><a href="#案例的实现步骤" class="headerlink" title="案例的实现步骤"></a>案例的实现步骤</h4><ul>
<li><p>创建两个正则表达式，分别用来匹配<style>和<script>标签</p>
</li>
<li><p>使用fs模块，读取需要被处理的HTML文件</p>
</li>
<li><p>自定义 resolveCSS 法，来写入 index.css 样式文件</p>
</li>
<li><p>自定义resolveJS 方法，来写入indexjs 脚本文件</p>
</li>
<li><p>自定义resolveHTML方法，来写入index.html文件</p>
</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建正则表达式</span></span><br><span class="line"><span class="comment">// \s匹配空白字符 \S匹配非空白字符 *匹配任意次</span></span><br><span class="line"><span class="keyword">const</span> regStyle = <span class="regexp">/&lt;style&gt;[\s\S]*&lt;\/style&gt;/</span>;</span><br><span class="line"><span class="keyword">const</span> regScript = <span class="regexp">/&lt;script&gt;[\s\S]*&lt;\/script&gt;/</span>;</span><br><span class="line"></span><br><span class="line">fs.<span class="title function_">readFile</span>(path.<span class="title function_">join</span>(__dirname,<span class="string">&quot;../素材/index.html&quot;</span>),<span class="string">&#x27;utf-8&#x27;</span>,<span class="keyword">function</span>(<span class="params">err,dataStr</span>)&#123;</span><br><span class="line">    <span class="comment">// 文件读取失败的回调</span></span><br><span class="line">    <span class="keyword">if</span>(err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;读取文件失败&#x27;</span> + err.<span class="property">message</span>);</span><br><span class="line">    <span class="comment">// 文件读取成功的回调</span></span><br><span class="line">    <span class="comment">// 处理css文件</span></span><br><span class="line">    <span class="title function_">resolveCss</span>(dataStr);</span><br><span class="line">    <span class="comment">// 处理js文件</span></span><br><span class="line">    <span class="title function_">resolveScript</span>(dataStr);</span><br><span class="line">    <span class="comment">// 处理html文件</span></span><br><span class="line">    <span class="title function_">resolveHtml</span>(dataStr)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 处理css的方法</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">resolveCss</span>(<span class="params">htmlStr</span>)&#123;</span><br><span class="line">    <span class="comment">// 使用正则提取需要的内容</span></span><br><span class="line">    <span class="keyword">const</span> r1 = regStyle.<span class="title function_">exec</span>(htmlStr);</span><br><span class="line">    <span class="comment">// 将提取的内容进行replace替换操作</span></span><br><span class="line">    <span class="keyword">const</span> newCss = r1[<span class="number">0</span>].<span class="title function_">replace</span>(<span class="string">&#x27;&lt;style&gt;&#x27;</span>,<span class="string">&#x27;&#x27;</span>).<span class="title function_">replace</span>(<span class="string">&#x27;&lt;/style&gt;&#x27;</span>,<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    fs.<span class="title function_">writeFile</span>(path.<span class="title function_">join</span>(__dirname,<span class="string">&#x27;./clock/index.css&#x27;</span>),newCss,<span class="keyword">function</span>(<span class="params">err</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;写入css样式失败&quot;</span> + err.<span class="property">message</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;写入样式成功&#x27;</span>)</span><br><span class="line">    &#125;) </span><br><span class="line">&#125;  </span><br><span class="line"><span class="comment">// 处理script的方法</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">resolveScript</span>(<span class="params">htmlStr</span>)&#123;</span><br><span class="line">    <span class="comment">// 使用正则提取需要的内容</span></span><br><span class="line">    <span class="keyword">const</span> r1 = regScript.<span class="title function_">exec</span>(htmlStr);</span><br><span class="line">    <span class="comment">// 将提取的内容进行replace替换操作</span></span><br><span class="line">    <span class="keyword">const</span> newScript = r1[<span class="number">0</span>].<span class="title function_">replace</span>(<span class="string">&#x27;&lt;script&gt;&#x27;</span>,<span class="string">&#x27;&#x27;</span>).<span class="title function_">replace</span>(<span class="string">&#x27;&lt;/script&gt;&#x27;</span>,<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    fs.<span class="title function_">writeFile</span>(path.<span class="title function_">join</span>(__dirname,<span class="string">&#x27;./clock/index.js&#x27;</span>),newScript,<span class="keyword">function</span>(<span class="params">err</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;写入script样式失败&quot;</span> + err.<span class="property">message</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;写入js成功&#x27;</span>)</span><br><span class="line">    &#125;) </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理html的方法</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">resolveHtml</span>(<span class="params">htmlStr</span>)&#123;</span><br><span class="line">    <span class="comment">// 将字符串调用replace方法，把内嵌的style金额script替换link ，script</span></span><br><span class="line">    <span class="keyword">const</span> newHtml = htmlStr.<span class="title function_">replace</span>(regStyle,<span class="string">&#x27;&lt;link rel=&quot;stylesheet&quot; href=&quot;./index.css&quot;&gt;&#x27;</span>).<span class="title function_">replace</span>(regScript,<span class="string">&#x27;&lt;script src=&quot;./index.js&quot;&gt;&lt;/script&gt;&#x27;</span>);</span><br><span class="line">    <span class="comment">// 写入文件</span></span><br><span class="line">    fs.<span class="title function_">writeFile</span>(path.<span class="title function_">join</span>(__dirname,<span class="string">&#x27;./clock/index.html&#x27;</span>),newHtml,<span class="keyword">function</span>(<span class="params">err</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;写入html失败&quot;</span> + err.<span class="property">message</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;写入html成功&#x27;</span>)</span><br><span class="line">    &#125;) </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure></div>

<p><strong><font color='red'>1. fs.writeFile只能创建文件，不能创建目录，2. 重复使用fs.writeFile写入同一个文件的时候，后面的内容会覆盖前面的内容</font></strong></p>
<h2 id="http模块"><a href="#http模块" class="headerlink" title="http模块"></a>http模块</h2><blockquote>
<p>http 模块是 Node.is 官方提供的、用来创建 web 服务器的模块。通过 http 模块提供的 http.createServer0 方法，就能方便的把一台普通的电脑，变成一台Web 服务器，从而对外提供Web 资源服务。</p>
</blockquote>
<h3 id="理解http模块的作用"><a href="#理解http模块的作用" class="headerlink" title="理解http模块的作用"></a>理解http模块的作用</h3><blockquote>
<p>服务器和普通电脑的区别在于，服务器上安装了 web 服务器软件，例如: S、Apache 等。通过安装这些服务器软件就能把一台普通的电脑变成一台 web 服务器</p>
</blockquote>
<p>在 Nodejs 中，我们不需要使用 S、Apache 等这些第三方 web 服务器软件。因为我们可以基于 ode.js 提供的http 模块，通过几行简单的代码，就能轻松的手写一个服务器软件，从而对外提供 web 服务。</p>
<h3 id="服务器相关概念"><a href="#服务器相关概念" class="headerlink" title="服务器相关概念"></a>服务器相关概念</h3><h4 id="IP地址"><a href="#IP地址" class="headerlink" title="IP地址"></a>IP地址</h4><blockquote>
<p>IP 地址就是互联网上每台计算机的唯一地址，因此 P 地址具有唯一性。如果把“个人电脑”比作“一台电话”，那么“IP地址”就相当于“电话号码”，只有在知道对方IP 地址的前提下，才能与对应的电脑之间进行数据通信</p>
</blockquote>
<p>IP 地址的格式:通常用“点分十进制”表示成(a.b.c.d) 的形式，其中a,b,c,d 都是 0~255 之间的十进制整数。例如:用点分十进表示的IP地址(192.168.1.1)</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping www.baidu.com</span><br></pre></td></tr></table></figure></div>
<p>39.156.66.18</p>
<h4 id="域名和域名服务器-DNS"><a href="#域名和域名服务器-DNS" class="headerlink" title="域名和域名服务器(DNS)"></a>域名和域名服务器(DNS)</h4><blockquote>
<p>尽管IP 地址能够唯一地标记网络上的计算机，但IP地址是一长串数字，不直观，而且不便于记忆，于是人们又发明了另一套字符型的地址方案，即所谓的域名 (Domain Name) 地址</p>
</blockquote>
<p>IP地址和域名是一一对应的关系，这份对应关系存放在一种叫做域名服务器(DNS，Domain name server)的电脑中。使用者只需通过好记的域名访问对应的服务器即可，对应的转换工作由域名服务器实现。因此，域名服务器就是提供 IP 地址和域名之间的转换服务的服务器</p>
<p>DNS就是转换域名为IP地址的</p>
<p><a class="link"   target="_blank" rel="noopener" href="http://www.baidu.com/" >www.baidu.com <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h4 id="端口号"><a href="#端口号" class="headerlink" title="端口号"></a>端口号</h4><blockquote>
<p>计算机中的端口号，就好像是现实生活中的门牌号一样。通过门牌号，外卖小哥可以在整栋大楼众多的房间中，准确把外卖送到你的手命</p>
</blockquote>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src=".%5Cpic%5C%E7%AB%AF%E5%8F%A3%E5%8F%B7.png"
                      alt="端口号"
                ></p>
<h3 id="创建基本的web服务器"><a href="#创建基本的web服务器" class="headerlink" title="创建基本的web服务器"></a>创建基本的web服务器</h3><blockquote>
<p>创建 web 服务器的基本步骤</p>
</blockquote>
<ol>
<li><p>导入http 模块</p>
</li>
<li><p>创建 web 服务器实例</p>
</li>
<li><p>为服务器实例绑定 request 事件，监听客户端的请求</p>
</li>
<li><p>启动服务器</p>
</li>
</ol>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 1. 导入http 模块</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 创建 web 服务器实例</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 为服务器实例绑定 request 事件，监听客户端的请求</span></span><br><span class="line"></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;request&#x27;</span>,<span class="keyword">function</span>(<span class="params">req,res</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;someone visit my web&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 4. 启动服务器</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">80</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;server running at http://127.0.0.1&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node 文件名</span><br></pre></td></tr></table></figure></div>

<h4 id="req请求对象"><a href="#req请求对象" class="headerlink" title="req请求对象"></a>req请求对象</h4><blockquote>
<p>只要服务器接收到了客户端的请求，就会调用通过server.on()为服务器绑定的request事件处理函数如果想在事件处理函数中，访问与客户端相关的数据或属性，可以使用如下的方式:</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>()</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&quot;request&quot;</span>,<span class="keyword">function</span>(<span class="params">req,res</span>)&#123;</span><br><span class="line">    <span class="comment">// req.url是客户端请求的URL地址</span></span><br><span class="line">    <span class="keyword">const</span> url = req.<span class="property">url</span>;</span><br><span class="line">    <span class="comment">// req.method是客户端请求的method类型</span></span><br><span class="line">    <span class="keyword">const</span> method = req.<span class="property">method</span>;</span><br><span class="line">    <span class="keyword">const</span> str = <span class="string">`Your request url is <span class="subst">$&#123;url&#125;</span>, and request method is <span class="subst">$&#123;method&#125;</span>`</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(str) <span class="comment">// Your request url is /, and request method is GET</span></span><br><span class="line">    <span class="comment">// 在http://127.0.0.1/index.html url就是 /index.html  </span></span><br><span class="line">&#125;)</span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">80</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;server running at http://127.0.0.1&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>
<h4 id="res响应对象"><a href="#res响应对象" class="headerlink" title="res响应对象"></a>res响应对象</h4><blockquote>
<p>在服务器的 request 事件处理函数中，如果想访问与服务器相关的数据或属性，可以使用如下的方式</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>()</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&quot;request&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> url = req.<span class="property">url</span>;</span><br><span class="line">    <span class="keyword">const</span> method = req.<span class="property">method</span>;</span><br><span class="line">    <span class="keyword">const</span> str = <span class="string">`Your request url is <span class="subst">$&#123;url&#125;</span>, and request method is <span class="subst">$&#123;method&#125;</span>`</span>;</span><br><span class="line">    <span class="comment">// 调用res.end()方法,向客户端响应一些内容,并结束这次请求的处理过程</span></span><br><span class="line">    res.<span class="title function_">end</span>(str)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">80</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;server running at http://127.0.0.1&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<h4 id="解决中文乱码问题"><a href="#解决中文乱码问题" class="headerlink" title="解决中文乱码问题"></a>解决中文乱码问题</h4><blockquote>
<p>当调用 res.end0 方法，向客户端发送中文内容的时候，会出现乱码问题，此时，需要手动设置内容的编码格式</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>();</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&quot;request&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// 定义的字符串</span></span><br><span class="line">    <span class="keyword">const</span> &#123;url,method&#125; = req;</span><br><span class="line">    <span class="keyword">const</span> str = <span class="string">`请求的url地址是<span class="subst">$&#123;url&#125;</span>,请求的类型是<span class="subst">$&#123;method&#125;</span>`</span></span><br><span class="line">    <span class="comment">// res.end()将内容响应给客户端</span></span><br><span class="line">    <span class="comment">// res.setHeader</span></span><br><span class="line">    <span class="comment">//为了防止中文乱码的问题，需要设置响应头 Content-Type 的值为 text/html; charset=utf-8</span></span><br><span class="line">    res.<span class="title function_">setHeader</span>(<span class="string">&quot;Content-Type&quot;</span>,<span class="string">&quot;text/html;charset=utf-8&quot;</span>)</span><br><span class="line">    res.<span class="title function_">end</span>(str)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">80</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;server running at http://127.0.0.1&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<h4 id="根据不同的url响应不同的html内容"><a href="#根据不同的url响应不同的html内容" class="headerlink" title="根据不同的url响应不同的html内容"></a>根据不同的url响应不同的html内容</h4><ul>
<li>获取请求的 url 地址</li>
<li>设置默认的响应内容为404 Not found</li>
<li>判断用户请求的是否为/或/index.html首页</li>
<li>判断用户请求的是否为 /about.html 关于页面</li>
<li>设置 Content-Type 响应头，防止中文乱码</li>
<li>使用res.end()把内容响应给客户端</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>()</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;request&#x27;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;url,method&#125; = req;</span><br><span class="line">    <span class="keyword">let</span> content = <span class="string">&#x27;&lt;h1&gt;404 NOT found&lt;/h1&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span>(url === <span class="string">&quot;/&quot;</span> || url === <span class="string">&quot;/index.html&quot;</span>)&#123;</span><br><span class="line">        content = <span class="string">&quot;&lt;h1&gt;首页&lt;/h1&gt;&quot;</span>; </span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(url === <span class="string">&quot;/about.html&quot;</span>)&#123;</span><br><span class="line">        content = <span class="string">&#x27;&lt;h1&gt;关于&lt;/h1&gt;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Content-Type&#x27;</span>,<span class="string">&#x27;text/html;charset=utf-8&#x27;</span>);</span><br><span class="line">    res.<span class="title function_">end</span>(content);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">80</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;http://127.0.0.1&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<h3 id="案例-实现clock时钟的web服务器"><a href="#案例-实现clock时钟的web服务器" class="headerlink" title="案例:实现clock时钟的web服务器"></a>案例:实现clock时钟的web服务器</h3><blockquote>
<p>把文件的实际保存路径,作为每个资源的请求的url地址</p>
</blockquote>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src=".%5Cpic%5C%E6%97%B6%E9%92%9Fhttp.png"
                      alt="http时钟案例"
                ></p>
<blockquote>
<p>实现步骤</p>
</blockquote>
<ul>
<li>导入需要的模块</li>
<li>创建基本的web服务器</li>
<li>将资源的请求url地址映射为文件的存放路径</li>
<li>读取文件内容并响应给客户端</li>
<li>优化资源的请求路径</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>()</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;request&#x27;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> url = req.<span class="property">url</span>;</span><br><span class="line">    <span class="comment">// 获取url地址</span></span><br><span class="line">    <span class="comment">// /clock/index.html  /clock/index.css  /clock/index.js</span></span><br><span class="line">    <span class="comment">// 把请求的url地址映射为具体文件的存放路径</span></span><br><span class="line">    <span class="keyword">const</span> fpath = path.<span class="title function_">join</span>(__dirname,url);</span><br><span class="line">    <span class="comment">// const htmlStr = path.join(__dirname,&#x27;../../clock/index.html&#x27;)</span></span><br><span class="line">    <span class="comment">// const cssStr = path.join(__dirname,&#x27;../../clock/index.css&#x27;)</span></span><br><span class="line">    <span class="comment">// const jsStr = path.join(__dirname,&#x27;../../clock/index.js&#x27;)</span></span><br><span class="line">    <span class="comment">// if(url === &quot;/index.html&quot; || url === &quot;/&quot;)&#123;</span></span><br><span class="line">    <span class="comment">//     res.setHeader(&#x27;ContentType&#x27;,&quot;text/html;charset=utf-8&quot;);</span></span><br><span class="line">    <span class="comment">//     res.end(htmlStr,cssStr,jsStr)</span></span><br><span class="line">    <span class="comment">// &#125;else&#123;</span></span><br><span class="line">    <span class="comment">//     res.end(&quot;&lt;h1&gt;404&lt;/h1&gt;&quot;)</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="comment">// 读取文件的内容</span></span><br><span class="line">    fs.<span class="title function_">readFile</span>(fpath,<span class="string">&#x27;utf-8&#x27;</span>,<span class="function">(<span class="params">err,dataStr</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">// 读取失败</span></span><br><span class="line">        <span class="keyword">if</span>(err) <span class="keyword">return</span> res.<span class="title function_">end</span>(<span class="string">&#x27;404 not found&#x27;</span>) </span><br><span class="line">        res.<span class="title function_">end</span>(dataStr)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">80</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;server running at http://127.0.0.1&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>
<p>优化</p>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>()</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;request&#x27;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> url = req.<span class="property">url</span>;</span><br><span class="line">    <span class="keyword">let</span> fpath =<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span>(url === <span class="string">&#x27;/&#x27;</span>)&#123;</span><br><span class="line">        fpath = path.<span class="title function_">join</span>(__dirname,<span class="string">&quot;/clock/index.html&quot;</span>)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        fpath = path.<span class="title function_">join</span>(__dirname,<span class="string">&#x27;/clock&#x27;</span>,url)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 读取文件的内容</span></span><br><span class="line">    fs.<span class="title function_">readFile</span>(fpath,<span class="string">&#x27;utf-8&#x27;</span>,<span class="function">(<span class="params">err,dataStr</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">// 读取失败</span></span><br><span class="line">        <span class="keyword">if</span>(err) <span class="keyword">return</span> res.<span class="title function_">end</span>(<span class="string">&#x27;404 not found&#x27;</span>) </span><br><span class="line">        res.<span class="title function_">end</span>(dataStr)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">80</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;server running at http://127.0.0.1&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<h2 id="模块化"><a href="#模块化" class="headerlink" title="模块化"></a>模块化</h2><blockquote>
<p>模块化是指解决一个复杂问题时，自顶向下逐层把系统划分成若干模块的过程。对于整个系统来说，模块是可组合、分解和更换的单元。</p>
</blockquote>
<p>编程中的模块化</p>
<blockquote>
<p>编程领域中的模块化，就是遵守固定的规则，把一个大文件拆成独立并互相依赖的多个小模块.</p>
</blockquote>
<p>把代码进行模块化拆分的好处:</p>
<ul>
<li>提高了代码的复用性</li>
<li>提高了代码的可维护性</li>
<li>可以实现按需加载</li>
</ul>
<h3 id="模块化规范"><a href="#模块化规范" class="headerlink" title="模块化规范"></a>模块化规范</h3><p>模块化规范就是对代码进行模块化的拆分与组合时，需要遵守的那些规则。<br>例如:</p>
<ol>
<li>使用什么样的语法格式来引用模块</li>
<li>在模块中使用什么样的语法格式向外暴露成员</li>
</ol>
<h3 id="nodeJs分类"><a href="#nodeJs分类" class="headerlink" title="nodeJs分类"></a>nodeJs分类</h3><p>根据模块的来源，可以分为3大类：</p>
<ul>
<li>内置模块(内置模块是由 Node.js 官方提供的，例如 fs，path，http 等)</li>
<li>自定义模块(用户创建的每个 .js 文件，都是自定义模块)</li>
<li>第三方模块(由第三方开发出来的模块，并非官方提供的内置模块，也不是用户创建的自定义模块，使用前需要先下载</li>
</ul>
<h3 id="加载模块"><a href="#加载模块" class="headerlink" title="加载模块"></a>加载模块</h3><blockquote>
<p>使用强大的 require0 方法，可以加载需要的内置模块、用户自定义模块、第三方模块进行使用。例如:</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.加载内置的 fs 模块</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>( <span class="string">&#x27;fs &#x27;</span> )</span><br><span class="line"><span class="comment">// 2.加载用户的自定义模块</span></span><br><span class="line"> <span class="keyword">const</span> custom = <span class="built_in">require</span>( <span class="string">&#x27; ./custom.js&#x27;</span> )</span><br><span class="line"> <span class="comment">// 3，加载第三方模块(关于第三方模块的下载和使用，会在后面的课程中进行专门的讲解)</span></span><br><span class="line"> <span class="keyword">const</span> moment = <span class="built_in">require</span>( <span class="string">&#x27;moment &#x27;</span>)</span><br></pre></td></tr></table></figure></div>
<p><strong>注意：</strong><font color="red">使用require()方法加载其他模块的时候，会执行加载模块中的代码</font></p>
<blockquote>
<p>in.js</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;加载了模块&quot;</span>)</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>模块化.js</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注意: 在使用 require 加载用户自定义模块期间</span></span><br><span class="line"><span class="comment">// 可以省略 .js 的后缀名</span></span><br><span class="line"><span class="keyword">const</span> m1 = <span class="built_in">require</span>(<span class="string">&quot;./in.js&quot;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(m1)</span><br></pre></td></tr></table></figure></div>


<h3 id="nodeJs模块作用域"><a href="#nodeJs模块作用域" class="headerlink" title="nodeJs模块作用域"></a>nodeJs模块作用域</h3><blockquote>
<p>和函数作用域类似，在自定义模块中定义的变量、方法等成员，只能在当前模块内被访问，这种模块级别的访问限制，叫做模块作用域。</p>
</blockquote>
<p><em>模块作用域好处：</em></p>
<ul>
<li>防止全局污染，无法被外界访问</li>
</ul>
<h3 id="module对象"><a href="#module对象" class="headerlink" title="module对象"></a>module对象</h3><blockquote>
<p>在每个js自定义模块中都有一个module 对象,它里面存储了和当前模块有关的信息</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">module</span>)</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Module &#123;</span></span><br><span class="line"><span class="comment">  id: &#x27;.&#x27;,</span></span><br><span class="line"><span class="comment">  path: &#x27;C:\\Users\\Administrator\\Desktop\\python全</span></span><br><span class="line"><span class="comment">栈\\BaiduSyncdisk\\node\\code\\feil\\模块化&#x27;,</span></span><br><span class="line"><span class="comment">  exports: &#123;&#125;,</span></span><br><span class="line"><span class="comment">  filename: &#x27;C:\\Users\\Administrator\\Desktop\\python全栈\\BaiduSyncdisk\\node\\code\\feil\\模块化\\02module.js&#x27;,</span></span><br><span class="line"><span class="comment">  loaded: false,</span></span><br><span class="line"><span class="comment">  children: [],</span></span><br><span class="line"><span class="comment">  paths: [</span></span><br><span class="line"><span class="comment">    &#x27;C:\\Users\\Administrator\\Desktop\\python全栈\\BaiduSyncdisk\\node\\code\\feil\\模块化\\node_modules&#x27;,</span></span><br><span class="line"><span class="comment">    &#x27;C:\\Users\\Administrator\\Desktop\\python全栈\\BaiduSyncdisk\\node\\code\\feil\\node_modules&#x27;,       </span></span><br><span class="line"><span class="comment">    &#x27;C:\\Users\\Administrator\\Desktop\\python全栈\\BaiduSyncdisk\\node\\code\\node_modules&#x27;,</span></span><br><span class="line"><span class="comment">    &#x27;C:\\Users\\Administrator\\Desktop\\python全栈\\BaiduSyncdisk\\node\\node_modules&#x27;,</span></span><br><span class="line"><span class="comment">    &#x27;C:\\Users\\Administrator\\Desktop\\python全栈\\BaiduSyncdisk\\node_modules&#x27;,</span></span><br><span class="line"><span class="comment">    &#x27;C:\\Users\\Administrator\\Desktop\\python全栈\\node_modules&#x27;,</span></span><br><span class="line"><span class="comment">    &#x27;C:\\Users\\Administrator\\Desktop\\node_modules&#x27;,</span></span><br><span class="line"><span class="comment">    &#x27;C:\\Users\\Administrator\\node_modules&#x27;,        </span></span><br><span class="line"><span class="comment">    &#x27;C:\\Users\\node_modules&#x27;,</span></span><br><span class="line"><span class="comment">    &#x27;C:\\node_modules&#x27;</span></span><br><span class="line"><span class="comment">  ]</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h4 id="module-exports对象"><a href="#module-exports对象" class="headerlink" title="module.exports对象"></a>module.exports对象</h4><blockquote>
<p>在自定义模块中，可以使用 module.exports 对象，将模块内的成员共享出去，供外界使用</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> userName = <span class="string">&quot;颤三&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> user = <span class="string">&quot;管理员&quot;</span>;</span><br><span class="line"><span class="comment">// 向module.exports对象上挂在了一个username属性</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>.<span class="property">userName</span> = <span class="string">&quot;张三&quot;</span>;</span><br><span class="line"><span class="comment">// 向module.exports对象上挂载了 salHello方法</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>.<span class="property">sayHello</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(userName)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>.<span class="property">user</span> = user;</span><br></pre></td></tr></table></figure></div>


<p><em>使用 require0 方法导入模块时，导入的结果，永远以 module.exports 指向的对象为准</em></p>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. 向module.exports 属性上挂载了.username1</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>.<span class="property">username</span> = <span class="string">&quot;张三&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.module.exports 对象上挂载方法 </span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>.<span class="property">sayHellomodule</span>.<span class="property">exports</span>.<span class="property">sayHello</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Hello!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 3.让 module.exports 指向一个全新的对象</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">nickname</span>:<span class="string">&quot;小黑&quot;</span>,</span><br><span class="line">    sayhi () &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Hi! &#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="exports对象"><a href="#exports对象" class="headerlink" title="exports对象"></a>exports对象</h3><blockquote>
<p>由于 module.exports 单词写起来比较复杂，为了简化向外共享成员的代码，Node 提供了exports 对象。默认情况exports 和 module.exports 指向同一个对象。最终共享的结果，还是以 module.exports 指向的对象为准</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="built_in">exports</span> === <span class="variable language_">module</span>.<span class="property">exports</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure></div>

<p><font color="green">require()模块，得到的永远是module.exports指向的对象;建议不要在同一个模块中同时使用exports和module.exports</font></p>
<h3 id="nodeJs中的模块规范"><a href="#nodeJs中的模块规范" class="headerlink" title="nodeJs中的模块规范"></a>nodeJs中的模块规范</h3><blockquote>
<p>Node.is 遵循了 CommonJS 模块化规范，CommonJS 规定了模块的特性和各模块之间如何相互依赖</p>
</blockquote>
<ol>
<li>每个模块内部，module变量代表当前模块。</li>
<li>module 变量是一个对象，它的 exports 属性(即 module.exports) 是对外的接口。</li>
<li>加载某个模块，其实是加载该模块的 module.exports 属性。require() 方法用于加载模块.</li>
</ol>
<h2 id="包"><a href="#包" class="headerlink" title="包"></a>包</h2><blockquote>
<p>nodeJs中的第三方模块又叫做包，不同于 Node.js 中的内置模块与自定义模块，包是由第三方个人或团队开发出来的，免费供所有人使用</p>
</blockquote>
<h3 id="为什么需要包"><a href="#为什么需要包" class="headerlink" title="为什么需要包"></a>为什么需要包</h3><blockquote>
<p>由于 Node.js 的内置模块仅提供了一些底层的 API，导致在基于内置模块进行项目开发的时，效率很低包是基于内置模块封装出来的，提供了更高级、更方便的 API，极大的提高了开发效率。包和内置模块之间的关系，类似于Jquery和浏览器内置API之间的关系</p>
</blockquote>
<h3 id="下载包"><a href="#下载包" class="headerlink" title="下载包"></a>下载包</h3><p><a class="link"   target="_blank" rel="noopener" href="https://www.npmjs.com/" >https://www.npmjs.com/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br><a class="link"   target="_blank" rel="noopener" href="https://registry.npmjs.org/" >https://registry.npmjs.org/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br></pre></td></tr></table></figure></div>
<p>下载包</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install 包完整的名字</span><br></pre></td></tr></table></figure></div>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i 包完整的名字</span><br></pre></td></tr></table></figure></div>
<p>简单的使用包</p>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入包</span></span><br><span class="line"><span class="keyword">const</span> moment = <span class="built_in">require</span>(<span class="string">&#x27;moment&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> dt = <span class="title function_">moment</span>().<span class="title function_">format</span>(<span class="string">&quot;YYYY-MM-DD HH:mm:ss&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(dt)</span><br></pre></td></tr></table></figure></div>
<h3 id="安装了包之后多的文件作用"><a href="#安装了包之后多的文件作用" class="headerlink" title="安装了包之后多的文件作用"></a>安装了包之后多的文件作用</h3><p>初次装包完成后，在项目文件夹下多一个叫做 node_modules 的文件夹和 package-lock.json 的配置文件<br>其中:<br>node_modules 文件夹用来存放所有已安装到项目中的包。require()导入第三方包时，就是从这个目录中香找并加载包，package-lock.json 配置文件用来记录 node_modules 目录下的每一个包的下载信息，例包的名字、版本号、下载地址等</p>
<blockquote>
<p>默认情况下，使用npm install 命令安装包的时候会自动安装最新版本的包。如果需要安装指定版本的包，可以在包名之后，通过 @ 符号指定具体的版本，例如:</p>
</blockquote>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i moment@2.22.2</span><br></pre></td></tr></table></figure></div>
<h4 id="包的语义化版本规范"><a href="#包的语义化版本规范" class="headerlink" title="包的语义化版本规范"></a>包的语义化版本规范</h4><p>包的版本号是以“点分十进制”形式进行定义的，总共有三位数字，例如 2.24.0其中每一位数字所代表的的含义如下:</p>
<ol>
<li>第1位数字:大版本</li>
<li>第2位数字:功能版本</li>
<li>第3位数字:Bug修复版本</li>
</ol>
<p>版本号提升的规则:<font color="yellow">只要前面的版本号增长了，则后面的版本号归零</font></p>
<h3 id="包管理配置文件"><a href="#包管理配置文件" class="headerlink" title="包管理配置文件"></a>包管理配置文件</h3><blockquote>
<p>npm 规定，在项目根目录中，必须提供一个叫做 package.json 的包管理配置文件。用来记录与项目有关的一些配置信息。例如:</p>
</blockquote>
<ul>
<li>项目的名称版本号、描述等</li>
<li>项目中都用到了哪些包</li>
<li>哪些包只在开发期间会用到</li>
<li>那些包在开发和部署时都需要用到</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src=".%5Cpic%5C%E5%8C%85%E7%AE%A1%E7%90%86.png"
                      alt="包管理"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src=".%5Cpic%5C%E5%88%9B%E5%BB%BApackjson.png"
                      alt="创建packjson"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src=".%5Cpic%5Cdependencies%E8%8A%82%E7%82%B9.png"
                      alt="dependencies节点"
                ></p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i</span><br></pre></td></tr></table></figure></div>
<p><font color="red">可以一次性下载所有包</font></p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm uninstall 包名称</span><br></pre></td></tr></table></figure></div>
<p><font color="red">卸载包</font></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src=".%5Cpic%5Cdev%E8%8A%82%E7%82%B9.png"
                      alt="dev节点"
                ></p>
<p><em>解决npm下载慢的问题</em></p>
<p>使用淘宝镜像</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看当前下包镜像地址</span></span><br><span class="line">npm config get registry</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将下包的地址换为淘宝地址</span></span><br><span class="line">npm config set registry=https://registry.npm.taobao.org/</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src=".%5Cpic%5Cnrm.png"
                      alt="nrm"
                ></p>
<h3 id="包的分类"><a href="#包的分类" class="headerlink" title="包的分类"></a>包的分类</h3><ol>
<li>项目包<blockquote>
<p>那些被安装到项目的 node modules 目录中的包，都是项目包</p>
</blockquote>
</li>
</ol>
<p>项目包又分为两类，分别是:</p>
<ul>
<li>开发赖包(被记录到devDependencies 节点中的包，只在开发期间会用到)</li>
<li>核心依赖包(被记录到 dependencies 节点中的包，在开发期间和项目上线之后都会用到)</li>
</ul>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">开发依赖包（会被记录到被记录到devDependencies）</span></span><br><span class="line">npm i 包名 -D </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">核心依赖包（会被记录到被记录到dependencies）</span></span><br><span class="line">npm i</span><br></pre></td></tr></table></figure></div>
<ol start="2">
<li>全局包</li>
</ol>
<blockquote>
<p>在执行 npm install 命令时，如果提供了 -g 参数，则会把包安装为全局包全局包会被安装到 C:\Users\用户目录\AppDataRoaming\npm\node modules 目录下</p>
</blockquote>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">全局安装指定的包</span></span><br><span class="line">npm i 包名 -g </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">卸载全局包</span></span><br><span class="line">npm uninstall 包名 -g</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>只有工具性质的包，才有全局安装的必要性。因为它们提供了好用的终端命令判断</p>
</li>
<li><p>某个包是否需要全局安装后才能使用，可以参考官方提供的使用说明即可</p>
</li>
</ul>
<h4 id="i5ting-toc"><a href="#i5ting-toc" class="headerlink" title="i5ting_toc"></a>i5ting_toc</h4><p>可以将md文档转为html的工具</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将 i5ting_toc 安装为全局包</span></span><br><span class="line">npm install -g i5ting_toc</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">用 i5ting_toc，轻松实现 md 转 html 的功能</span></span><br><span class="line">i5ting_toc -f 要转换的md文件路径 -o</span><br></pre></td></tr></table></figure></div>

<h3 id="npm与包"><a href="#npm与包" class="headerlink" title="npm与包"></a>npm与包</h3><blockquote>
<p>包的规范</p>
</blockquote>
<p>一个规范的包，它的组成结构，必须符合以下3 点要求:</p>
<ul>
<li>包必须以单独的目录而存在</li>
<li>包的顶级目录下要必须包含 package.json 这个包管理配置文件</li>
<li>package.json 中必须包含 name，version，main 这三个属性，分别代表包的名字、版本号、包的入口</li>
</ul>
<h3 id="开发一个自己的包"><a href="#开发一个自己的包" class="headerlink" title="开发一个自己的包"></a>开发一个自己的包</h3><blockquote>
<p>初始化包的基本结构</p>
</blockquote>
<ol>
<li>新建im-tools文件夹，作为包的根目录</li>
<li>在im-tools 文件夹中，新建如下三个文件<ul>
<li>package.json(包管理配置文件)</li>
<li>index.js(包的入口文件)</li>
<li>README.md(包的说明文档)</li>
</ul>
</li>
</ol>
<blockquote>
<p>package.json</p>
</blockquote>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;im-tools&quot;</span><span class="punctuation">,</span>  <span class="comment">// 包的名字</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span> <span class="comment">// 包的版本</span></span><br><span class="line">    <span class="attr">&quot;main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;index.js&quot;</span><span class="punctuation">,</span> <span class="comment">// 包的入口文件</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;提供了格式化时间，HTMLEscape的功能&quot;</span><span class="punctuation">,</span> <span class="comment">// 包的简单描述</span></span><br><span class="line">    <span class="attr">&quot;keywords&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;im-tools&quot;</span><span class="punctuation">,</span><span class="string">&quot;dataFormat&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="comment">// 包的简单关键字</span></span><br><span class="line">    <span class="attr">&quot;license&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ISC&quot;</span> <span class="comment">// 开源许可协议</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>index.js</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">dataFormat</span>(<span class="params">dataStr</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> dt = <span class="keyword">new</span> <span class="title class_">Date</span>(dataStr);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> y = <span class="title function_">padZero</span>(dt.<span class="title function_">getFullYear</span>());</span><br><span class="line">    <span class="keyword">const</span> m = <span class="title function_">padZero</span>(dt.<span class="title function_">getMonth</span>() + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">const</span> d = <span class="title function_">padZero</span>(dt.<span class="title function_">getDate</span>());</span><br><span class="line">    <span class="keyword">const</span> hh = <span class="title function_">padZero</span>(dt.<span class="title function_">getHours</span>());</span><br><span class="line">    <span class="keyword">const</span> mm = <span class="title function_">padZero</span>(dt.<span class="title function_">getMinutes</span>());</span><br><span class="line">    <span class="keyword">const</span> ss = <span class="title function_">padZero</span>(dt.<span class="title function_">getSeconds</span>());</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;y&#125;</span>-<span class="subst">$&#123;m&#125;</span>-<span class="subst">$&#123;d&#125;</span> <span class="subst">$&#123;hh&#125;</span>:<span class="subst">$&#123;mm&#125;</span>:<span class="subst">$&#123;ss&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个补零的函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">padZero</span>(<span class="params">n</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> n &gt; <span class="number">9</span> ? n : <span class="string">&quot;0&quot;</span> + n;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 转义html字符的函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">htmlEscape</span>(<span class="params">htmlStr</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> htmlStr.<span class="title function_">replace</span>(<span class="regexp">/&lt;|&gt;|&quot;&amp;/g</span>, <span class="function">(<span class="params">match</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (match) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;&lt;&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;&amp;lt;&#x27;</span></span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;&gt;&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;&amp;gt;&#x27;</span></span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;&quot;&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;&amp;quot;&#x27;</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;&amp;&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;&amp;amp;&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义还原html字符串的函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">htmlUnEscape</span>(<span class="params">str</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> htmlStr.<span class="title function_">replace</span>(<span class="regexp">/&amp;lt;|&amp;gt;|&amp;quot;|&amp;amp;/g</span>, <span class="function">(<span class="params">match</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (match) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;&amp;lt;&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;&lt;&#x27;</span></span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;&amp;gt;&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;&gt;&#x27;</span></span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;&amp;quot;&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;&amp;amp;&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;&amp;&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 向外暴露</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    dataFormat,</span><br><span class="line">    htmlEscape,</span><br><span class="line">    htmlUnEscape</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<blockquote>
<p>data.js</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> imTools = <span class="built_in">require</span>(<span class="string">&#x27;../im-tools&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> dtStr = imTools.<span class="title function_">dataFormat</span>(<span class="keyword">new</span> <span class="title class_">Date</span>())</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> htmlStr = <span class="string">&#x27;&lt;h1 title=&quot;abc&quot;&gt;这是h1标签&lt;/h1&gt;&#x27;</span></span><br><span class="line"><span class="keyword">const</span> str = imTools.<span class="title function_">htmlEscape</span>(htmlStr)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(dtStr)</span><br></pre></td></tr></table></figure></div>


<h4 id="模块化的拆分"><a href="#模块化的拆分" class="headerlink" title="模块化的拆分"></a>模块化的拆分</h4><p>将不同的功能进行模块化的拆分</p>
<ul>
<li>将格式化时间的功能，拆分到 src -&gt; dateFormat.js中，</li>
<li>将处理 HTML 字符串的功能，拆分到 src -&gt;htmlEscape.js 中</li>
<li>在index.js 中，导入两个模块，得到需要向外共享的方法</li>
<li>在index.js 中，使用 module.exports 把对应的方法共享出去</li>
</ul>
<h3 id="发布包"><a href="#发布包" class="headerlink" title="发布包"></a>发布包</h3><ul>
<li>访问 <a class="link"   target="_blank" rel="noopener" href="https://www.npmjs.com/" >https://www.npmjs.com/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> 网站，点击 sign up 按钮，进入注册用户界面</li>
<li>填写账号相关的信息: Full Name、Public Email、Username、Password</li>
<li>点击 Create an Account 按钮，注册账号</li>
<li>登录邮箱，点击验证连接，进行账号的验证</li>
</ul>
<h2 id="express"><a href="#express" class="headerlink" title="express"></a>express</h2><blockquote>
<p>Express是基于nodeJs平台，快速、开发、极其简单的web开发框架，通俗的理解: Express 的作用和 Node.js 内置的 http 模块类似，是专门用来创建 Web 服务器的Express的本质:就是一个npm 上的第三方包，提供了快速创建Web 服务器的便捷方法<br>Express 的中文官网: <a class="link"   target="_blank" rel="noopener" href="http://www.expressjs.com.cn/" >http://www.expressjs.com.cn/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</blockquote>
<h3 id="Express-能做什么"><a href="#Express-能做什么" class="headerlink" title="Express 能做什么"></a>Express 能做什么</h3><p>对于前端程序员来说，最常见的两种服务器，分别是:</p>
<ul>
<li>Web 网站服务器: 专门对外提供 Web 网页资源的服务器</li>
<li>API 接口服务器:专门对外提供 API 接口的服务器使用 </li>
</ul>
<p>Express，我们可以方便、快速的创建 Web 网站的服务器或 API 接口的服务器</p>
<blockquote>
<p>安装express</p>
</blockquote>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i express@4.17.1</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>基本使用</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建web服务</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"><span class="comment">// 启动服务</span></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">80</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;http://127.0.0.1&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>
<h3 id="监听get请求"><a href="#监听get请求" class="headerlink" title="监听get请求"></a>监听get请求</h3><blockquote>
<p>app.get(),可以监听客户端的get请求，</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 参数1: 客户端请的 URL 地址</span></span><br><span class="line"><span class="comment">//参数2: 请求对应的处理函数</span></span><br><span class="line"><span class="comment">//  req: 请求对象 (包含了与请求相关的属性与方法)</span></span><br><span class="line"><span class="comment">//  res: 响应对象 (包含了与响应相关的属性与方法)</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;请求URL&#x27;</span>，<span class="keyword">function</span>(<span class="params">req，res</span>)&#123; <span class="comment">/*处理函数*/</span> &#125;)</span><br></pre></td></tr></table></figure></div>

<h3 id="监听post请求"><a href="#监听post请求" class="headerlink" title="监听post请求"></a>监听post请求</h3><blockquote>
<p>app.post(),可以监听客户端的post请求，</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 参数1: 客户端请求的 URL 地址</span></span><br><span class="line"><span class="comment">// 参数2: 请求对应的处理函数</span></span><br><span class="line"><span class="comment">//  req: 请求对象 (包含了与请求相关的属性与方法)</span></span><br><span class="line"><span class="comment">//  res: 响应对象 (包含了与响应相关的属性与方法)</span></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&quot;请求URL&quot;</span>,<span class="keyword">function</span>(<span class="params">req，res</span>)&#123; <span class="comment">/*处理函数*/</span> &#125;)</span><br></pre></td></tr></table></figure></div>

<h3 id="内容响应给客户端"><a href="#内容响应给客户端" class="headerlink" title="内容响应给客户端"></a>内容响应给客户端</h3><blockquote>
<p>通过res.send()方法，可以把处理好的内容，发送给客户端</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/user&#x27;</span>,<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// 向户端发送 JSON 对象</span></span><br><span class="line">    res.<span class="title function_">send</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;zs&#x27;</span>, <span class="attr">age</span>: <span class="number">20</span>, <span class="attr">gender</span>:<span class="string">&#x27;男&#x27;</span> &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/user&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 向客户端发送文本内容</span></span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;请求成功&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>


<h3 id="获取URL中携带的查询参数"><a href="#获取URL中携带的查询参数" class="headerlink" title="获取URL中携带的查询参数"></a>获取URL中携带的查询参数</h3><blockquote>
<p>通过req.query()对象，可以访问到客户端通过查询字符串的形式，发送到服务器参数</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>,<span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// req.query 默认是一个空对象</span></span><br><span class="line">    <span class="comment">// 客户端使用 ?name=zs&amp;age=20 这种查询字符串形式，发送到服务器的参数</span></span><br><span class="line">    <span class="comment">// 可以通过 req.query 对象访问到，例如:// req.query .namereq. query .age</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">query</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<h3 id="获取url中的动态参数"><a href="#获取url中的动态参数" class="headerlink" title="获取url中的动态参数"></a>获取url中的动态参数</h3><blockquote>
<p>通过 req.params 对象，可以访问到 URL中，通过:匹配到的动态参数</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// URL 地址中，可以通过 :参数名 的形式，匹配动态参数值</span></span><br><span class="line"><span class="comment">// 这里的id是动态的参数 : 是固定的写法，那个动态就在 ： 后面写</span></span><br><span class="line">app.<span class="title function_">get</span>( <span class="string">&#x27;/user/:id&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// req.params 默认是一个空对象</span></span><br><span class="line">    <span class="comment">//里面存放着通过 : 动态匹配到的参数值</span></span><br><span class="line">    <span class="variable language_">console</span>. <span class="title function_">log</span>(req.<span class="property">params</span> )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<h3 id="托管静态资源"><a href="#托管静态资源" class="headerlink" title="托管静态资源"></a>托管静态资源</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src=".%5Cpic%5C%E6%89%98%E7%AE%A1%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90.png"
                      alt="托管静态资源"
                ></p>
<h3 id="托管多个静态资源目录"><a href="#托管多个静态资源目录" class="headerlink" title="托管多个静态资源目录"></a>托管多个静态资源目录</h3><ul>
<li>如果托管多个静态资源目录，就多次调用express.static()函数</li>
<li>访问静态资源文件时，express.static()函数会根据目录的添加顺序查找所需的文件</li>
</ul>
<h3 id="挂载路径前缀"><a href="#挂载路径前缀" class="headerlink" title="挂载路径前缀"></a>挂载路径前缀</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src=".%5Cpic%5C%E6%8C%82%E8%BD%BD%E5%89%8D%E7%BC%80.png"
                      alt="挂载前缀"
                ></p>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用express.static（）对外提供静态文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 访问路径 ：http://127.0.0.1/</span></span><br><span class="line"><span class="comment">// app.use(express.static(&#x27;./clock&#x27;))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 访问路径 ：http://127.0.0.1/clock/</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/clock&#x27;</span>,express.<span class="title function_">static</span>(<span class="string">&#x27;./clock&#x27;</span>))</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">80</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;http://127.0.0.1&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<h2 id="nodemon"><a href="#nodemon" class="headerlink" title="nodemon"></a>nodemon</h2><h3 id="为什么使用"><a href="#为什么使用" class="headerlink" title="为什么使用"></a>为什么使用</h3><blockquote>
<p>在编写调试 Node.js 项目的时候，如果修改了项目的代码，则需要频繁的手动 close 掉，然后再重新启动，非常繁琐。</p>
</blockquote>
<p>现在，我们可以使用nodemon(<a class="link"   target="_blank" rel="noopener" href="https://www.npmjs.package/nodemon)%E8%BF%99%E4%B8%AA%E5%B7%A5%E5%85%B7%EF%BC%8C%E5%AE%83%E8%83%BD%E5%A4%9F%E7%9B%91%E5%90%AC%E9%A1%B9%E7%9B%AE%E6%96%87%E4%BB%B6%E7%9A%84%E5%8F%98%E5%8A%A8%EF%BC%8C%E5%BD%93%E4%BB%A3%E7%A0%81%E8%A2%AB%E4%BF%AE%E6%94%B9%E5%90%8E%EF%BC%8C%E4%BC%9A%E8%87%AA%E5%8A%A8%E5%B8%AE%E6%88%91%E4%BB%AC%E9%87%8D%E5%90%AF%E9%A1%B9%E7%9B%AE%EF%BC%8C%E6%9E%81%E5%A4%A7%E6%96%B9%E4%BE%BF%E4%BA%86%E5%BC%80%E5%8F%91%E5%92%8C%E8%B0%83%E8%AF%95" >https://www.npmjs.package/nodemon)这个工具，它能够监听项目文件的变动，当代码被修改后，会自动帮我们重启项目，极大方便了开发和调试 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h3 id="安装nodemon"><a href="#安装nodemon" class="headerlink" title="安装nodemon"></a>安装nodemon</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install nodemon -g</span><br></pre></td></tr></table></figure></div>

<h3 id="使用nodemon"><a href="#使用nodemon" class="headerlink" title="使用nodemon"></a>使用nodemon</h3><p>当基于 Nodejs 编写了一个网站应用的时候，传统的方式，是运行 node app.js 命令，来启动项目。这样做的坏处是:代码被修改之后，需要手动重启项目。<br>现在，我们可以将node 命令替换为 nodemon 命令，使用 nodemon app.js 来启动项目。这样做的好处是:代码被修改之后，会被nodemon 监听到，从而实现自动重启项目的效果。</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nodemon app.js</span><br></pre></td></tr></table></figure></div>

<h3 id="express路由"><a href="#express路由" class="headerlink" title="express路由"></a>express路由</h3><blockquote>
<p>在 Express 中，路由指的是客户端的请求与服务器处理函数之间的映射关系。Express 中的路由分 3 部分组成，分别是请求的类型、请求的 URL 地址、处理函数，格式如下:</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aPP.<span class="title function_">METHOD</span>(<span class="variable constant_">PATH</span>，<span class="variable constant_">HANDLER</span>)</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 匹配 GET 请求，且请求 URL 为 </span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;Hello World!&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//匹配 POST 请求，且请求 URL 为 </span></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27; Got a POST request&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<h4 id="路由的匹配过程"><a href="#路由的匹配过程" class="headerlink" title="路由的匹配过程"></a>路由的匹配过程</h4><blockquote>
<p>每当一个请求到达服务器之后，需要先经过路由的匹配，只有匹配成功之后，才会调用对应的处理函数。在匹配时，会按照路由的顺序进行匹配，如果请求类型和请求的 URL 同时匹配成功，则 Express 会将这次请求，转交给对应的 function 函数进行处理</p>
</blockquote>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src=".%5Cpic%5C%E8%B7%AF%E7%94%B1%E5%8C%B9%E9%85%8D%E8%BF%87%E7%A8%8B.png"
                      alt="路由匹配过程"
                ><br><strong>注意点</strong></p>
<ol>
<li>按照定义的先后顺序进行匹配</li>
<li>请求类型和请求的URL同时匹配成功才会调用对应的处理函数</li>
</ol>
<h3 id="简单使用"><a href="#简单使用" class="headerlink" title="简单使用"></a>简单使用</h3><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span>  express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 挂载路由</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;你好&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">80</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;http://127.0.0.1&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<h4 id="模块化路由"><a href="#模块化路由" class="headerlink" title="模块化路由"></a>模块化路由</h4><blockquote>
<p>为了方便对路由进行模块化的管理，Express 不建议将路由直接挂载到 app 上，而是推荐将路由抽离为单独的模块</p>
</blockquote>
<ul>
<li>创建路由模块对应的.js文件</li>
<li>调用express.Routed()函数创建路由对象</li>
<li>向路由对象上挂载具体的路由</li>
<li>用 module.exports 向外共享路由对象</li>
<li>使用app.use()函数注册路由模块</li>
</ul>
<blockquote>
<p>创建路由模块</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 路由模块</span></span><br><span class="line"><span class="comment">// 1. 导入express，模块</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 创建路由对象</span></span><br><span class="line"><span class="keyword">const</span> route = express.<span class="title class_">Router</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 挂载具体的路由</span></span><br><span class="line">route.<span class="title function_">get</span>(<span class="string">&#x27;/user/list&#x27;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;user_list&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">route.<span class="title function_">post</span>(<span class="string">&#x27;/user/add&#x27;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;user_add&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 向外暴露 </span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = route</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>注册路由模块</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 导入路由模块</span></span><br><span class="line"><span class="keyword">const</span> userRoute = <span class="built_in">require</span>(<span class="string">&#x27;./05-1路由模块&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 注册</span></span><br><span class="line"><span class="comment">// app.use() 用来注册全局中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(userRoute)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">80</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;http://127.0.0.1&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<h4 id="给路由模块添加前缀"><a href="#给路由模块添加前缀" class="headerlink" title="给路由模块添加前缀"></a>给路由模块添加前缀</h4><blockquote>
<p>类似于托管静态资源时，为静态资源统一挂载访问前缀一样，路由模块添加前缀的方式也非常简单:</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 导入路由模块</span></span><br><span class="line"><span class="keyword">const</span> userRoute = <span class="built_in">require</span>(<span class="string">&#x27;./05-1路由模块&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 注册</span></span><br><span class="line"><span class="comment">// app.use() 用来注册全局中间件</span></span><br><span class="line"><span class="comment">// 挂载前缀</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/api&#x27;</span>,userRoute)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">80</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;http://127.0.0.1&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<h3 id="express中间件"><a href="#express中间件" class="headerlink" title="express中间件"></a>express中间件</h3><h4 id="express中间件的调用流程"><a href="#express中间件的调用流程" class="headerlink" title="express中间件的调用流程"></a>express中间件的调用流程</h4><blockquote>
<p>当一个请求到达 Express 的服务器之后，可以连续调用多个中间件，从而对这次请求进行预处理</p>
</blockquote>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src=".%5Cpic%5Cexpress%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E8%B0%83%E7%94%A8%E6%B5%81%E7%A8%8B.png"
                      alt="express中间件的调用流程"
                ></p>
<h4 id="中间件的格式"><a href="#中间件的格式" class="headerlink" title="中间件的格式"></a>中间件的格式</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src=".%5Cpic%5C%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%A0%BC%E5%BC%8F.png"
                      alt="中间件的格式"
                ></p>
<h4 id="next-函数的作用"><a href="#next-函数的作用" class="headerlink" title="next()函数的作用"></a>next()函数的作用</h4><blockquote>
<p>next 函数是实现多个中间件连续调用的关键，它表示把流转关系转交给下一个中间件或路由</p>
</blockquote>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src=".%5Cpic%5Cnext()%E5%87%BD%E6%95%B0%E7%9A%84%E4%BD%9C%E7%94%A8.png"
                      alt="next()函数的作用"
                ></p>
<h4 id="定义最简单的中间件函数"><a href="#定义最简单的中间件函数" class="headerlink" title="定义最简单的中间件函数"></a>定义最简单的中间件函数</h4><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个中间件函数</span></span><br><span class="line"><span class="keyword">const</span> nf = <span class="keyword">function</span>(<span class="params">req,res,next</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;一个中间件&quot;</span>)</span><br><span class="line">    <span class="comment">// 转交给下一个中间件或者路由</span></span><br><span class="line">    <span class="title function_">next</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">80</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;http://127.0.0.1&quot;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<h4 id="全局生效的中间件"><a href="#全局生效的中间件" class="headerlink" title="全局生效的中间件"></a>全局生效的中间件</h4><blockquote>
<p>客户端发起的任何请求，到达服务器之后，都会触发的中间件，叫做全局生效的中间件.通过调用 app.use(中间件函数)，即可定义一个全局生效的中间件</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个中间件函数</span></span><br><span class="line"><span class="keyword">const</span> nf = <span class="keyword">function</span>(<span class="params">req,res,next</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;一个中间件&quot;</span>)</span><br><span class="line">    <span class="comment">// 转交给下一个中间件或者路由</span></span><br><span class="line">    <span class="title function_">next</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将nf注册为全局生效中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(nf)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;Home Page&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">80</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;http://127.0.0.1&quot;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<p><em><font color="red">简写形式</font></em></p>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req,res,next</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;helllllo&#x27;</span>)</span><br><span class="line">    <span class="title function_">next</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;Home Page&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">80</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;http://127.0.0.1&quot;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<h4 id="中间件的作用"><a href="#中间件的作用" class="headerlink" title="中间件的作用"></a>中间件的作用</h4><blockquote>
<p>多个中间件之间，共享同一份 req 和 res。基于这样的特性，我们可以在上游的中间件中，统一为 req 或 res 对象添加自定义的属性或方法，供下游的中间件或路由进行使用。</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req,res,next</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> time = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">    <span class="comment">// 给req挂载一个自定义属性，从而把时间暴露出去</span></span><br><span class="line">    req.<span class="property">startTime</span> = time;</span><br><span class="line">    <span class="title function_">next</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">startTime</span>)</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;Home Page&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">80</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;http://127.0.0.1&quot;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<h4 id="定义多个全局中间件"><a href="#定义多个全局中间件" class="headerlink" title="定义多个全局中间件"></a>定义多个全局中间件</h4><blockquote>
<p>可以使用 app.use() 连续定义多个全局中间件。客户端请求到达服务器之后，会按照中间件定义的先后顺序依次进行调用，示例代码如下:</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义第一个全局中间价</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req,res,next</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;第一个全局中间价&quot;</span>)</span><br><span class="line">    <span class="title function_">next</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义第二个全局中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req,res,next</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;第二个全局中间价&quot;</span>)</span><br><span class="line">    <span class="title function_">next</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个路由</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">80</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;http://127.0.0.1&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<h4 id="局部中间件"><a href="#局部中间件" class="headerlink" title="局部中间件"></a>局部中间件</h4><blockquote>
<p>不使用 app.use()定义的中间件，叫做局部生效的中间件</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 局部生效的中间件,定义中间件函数</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">v1</span> = (<span class="params">req,res,next</span>)=&gt;&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;局部中间件&#x27;</span>)</span><br><span class="line">    <span class="title function_">next</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 2. 创建路由</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>,v1,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;helloPage&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/home&#x27;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;homePage&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">80</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;http://127.0.0.1&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<h4 id="定义多个局部中间件"><a href="#定义多个局部中间件" class="headerlink" title="定义多个局部中间件"></a>定义多个局部中间件</h4><blockquote>
<p>可以在路由中，通过如下两种等价的方式，使用多个局部中间件</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 等价</span></span><br><span class="line">app .<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, mw1, mw2, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123; res.<span class="title function_">send</span>( <span class="string">&#x27;Home page.&#x27;</span>) &#125;)</span><br><span class="line">app .<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>,[mw1, mw2], <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123; res.<span class="title function_">send</span>( <span class="string">&#x27;Home page.&#x27;</span>) &#125;)</span><br></pre></td></tr></table></figure></div>

<h4 id="中间件的5个注意事项"><a href="#中间件的5个注意事项" class="headerlink" title="中间件的5个注意事项"></a>中间件的5个注意事项</h4><ul>
<li>一定要在路由之前注册中间件</li>
<li>客户端发送过来的请求，可以连续调用多个中间件进行处理</li>
<li>执行完中间件的业务代码之后，不要忘记调用 next() 函数</li>
<li>为了防止代码逻辑混乱，调用 next()函数后不要再写额外的代码</li>
<li>连续调用多个中间件时，多个中间件之间，共享 req 和res 对象</li>
</ul>
<h4 id="中间件的分类"><a href="#中间件的分类" class="headerlink" title="中间件的分类"></a>中间件的分类</h4><p>为了方便大家理解和记忆中间件的使用，Express 官方把常见的中间件用法，分成了 5 大类，分别是</p>
<ul>
<li>应用级别的中间件<br>通过 app.use0 或 app.get()或 app.post()，绑定到 app 实例上的中间件，叫做应用级别的中间件，代码示例如下:<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src=".%5Cpic%5C%E5%BA%94%E7%94%A8%E7%BA%A7%E4%B8%AD%E9%97%B4%E4%BB%B6.png"
                      alt="应用级中间件"
                ></li>
<li>路由级别的中间件<br>绑定到 express.Router（）实例上的中间件，叫做路由级别的中间件。它的用法和应用级别中间件没有任何区别。只不过，应用级别中间件是绑定到 app 实例上，路由级别中间件绑定到 router 实例上，代码示例如下:<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src=".%5Cpic%5C%E8%B7%AF%E7%94%B1%E7%BA%A7%E4%B8%AD%E9%97%B4%E4%BB%B6.png"
                      alt="路由级中间件"
                ></li>
<li>错误级别的中间件<br>错误级别中间件的作用:专门用来捕获整个项目中发生的异常错误，从而防止项目异常崩溃的问题。格式: 错误级别中间件的 function 处理函数中，必须有 4 个形参，形参顺序从前到后，分别是(ert,req, res, next)。<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src=".%5Cpic%5C%E9%94%99%E8%AF%AF%E7%BA%A7%E5%88%AB%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6.png"
                      alt="错误级别的中间件"
                ></li>
<li>Express内置的中间件<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src=".%5Cpic%5CExpress%E5%86%85%E7%BD%AE%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6.png"
                      alt="Express内置的中间件"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src=".%5Cpic%5CExpress%E5%86%85%E7%BD%AE%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6-1.png"
                      alt="Express内置的中间件-1"
                ></li>
<li>第三方的中间件<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src=".%5Cpic%5C%E7%AC%AC%E4%B8%89%E6%96%B9%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6.png"
                      alt="第三方的中间件"
                ></li>
</ul>
<h4 id="自定义中间件"><a href="#自定义中间件" class="headerlink" title="自定义中间件"></a>自定义中间件</h4><blockquote>
<p>自己手动模拟一个类似于 express.urlencoded 这样的中间件，来解析 POST 提交到服务器的表单数据</p>
</blockquote>
<ol>
<li>定义中间件</li>
<li>监听req的data事件<blockquote>
<p>如果数据量比较大，无法一次性发送完毕，则客户端会把数据切割后，分批发送到服务器。所以 data 事件可能会触发多次，每一次触发 data 事件时，获取到数据只是完整数据的一部分，需要手动对接收到的数据进行拼接。</p>
</blockquote>
</li>
<li>监听req的end事件<blockquote>
<p>因此，我们可以在reg的end 事件中，拿到并处理完整的请求体数据</p>
</blockquote>
</li>
<li>使用querstring模块解析请求体数据</li>
<li>将解析出来的数据对象挂载为 req.body<br>的自定义属性，命名为 req.body，供下游使用。上游的中间件和下游的中间件及路由之间，共享同一份 req 和 res。因此，我们可以将解析出来的数据，挂载为 req</li>
<li>将自定义中间件封装为模块</li>
</ol>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="comment">// 导入node内置的querystr模块</span></span><br><span class="line"><span class="keyword">const</span> qs = <span class="built_in">require</span>(<span class="string">&#x27;querystring&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这是解析表单数据的中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 定义中间价的具体业务</span></span><br><span class="line">    <span class="comment">// 定义一个str字符串变量，专门用来存储客户端发送过来的请求体数据</span></span><br><span class="line">    <span class="keyword">let</span> str = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="comment">// 监听req的data事件</span></span><br><span class="line">    req.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123;</span><br><span class="line">        str += chunk;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 监听req的end事件</span></span><br><span class="line">    req.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 在str中存储的是完整的请求体数据</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(str)</span><br><span class="line">        <span class="comment">// 将字符串格式的请求体数据，解析成对象格式</span></span><br><span class="line">        <span class="keyword">const</span> body = qs.<span class="title function_">parse</span>(str);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(body)</span><br><span class="line">        req.<span class="property">body</span> = body</span><br><span class="line">        <span class="title function_">next</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/user&#x27;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    res.<span class="title function_">send</span>(req.<span class="property">body</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">80</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;http://127.0.0.1&quot;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>封装</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入自己封装的中间件模块</span></span><br><span class="line"><span class="keyword">const</span> customBodyParser = <span class="built_in">require</span>(<span class="string">&#x27;./12-1.custom-body-parser&#x27;</span>)</span><br><span class="line"><span class="comment">// 将自定义的中间件函数，注册为全局可用的中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(customBodyParser)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/user&#x27;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    res.<span class="title function_">send</span>(req.<span class="property">body</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">80</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;http://127.0.0.1&quot;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入node内置的querystr模块</span></span><br><span class="line"><span class="keyword">const</span> qs = <span class="built_in">require</span>(<span class="string">&#x27;querystring&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">bodyParser</span> = (<span class="params">req, res, next</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 定义中间价的具体业务</span></span><br><span class="line">    <span class="comment">// 定义一个str字符串变量，专门用来存储客户端发送过来的请求体数据</span></span><br><span class="line">    <span class="keyword">let</span> str = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="comment">// 监听req的data事件</span></span><br><span class="line">    req.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123;</span><br><span class="line">        str += chunk;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 监听req的end事件</span></span><br><span class="line">    req.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 在str中存储的是完整的请求体数据</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(str)</span><br><span class="line">        <span class="comment">// 将字符串格式的请求体数据，解析成对象格式</span></span><br><span class="line">        <span class="keyword">const</span> body = qs.<span class="title function_">parse</span>(str);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(body)</span><br><span class="line">        req.<span class="property">body</span> = body</span><br><span class="line">        <span class="title function_">next</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = bodyParser</span><br></pre></td></tr></table></figure></div>

<h4 id="创建基本的服务器"><a href="#创建基本的服务器" class="headerlink" title="创建基本的服务器"></a>创建基本的服务器</h4><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="comment">// 配置解析表单数据的中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">urlencoded</span>(&#123;<span class="attr">extended</span>:<span class="literal">false</span>&#125;))</span><br><span class="line"><span class="comment">// 导入路由模块</span></span><br><span class="line"><span class="keyword">const</span> apiRouter = <span class="built_in">require</span>(<span class="string">&#x27;./14.创建api路由&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把路由模块，注册到app上</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/api&#x27;</span>,apiRouter)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">80</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;http://127.0.0.1&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="comment">// 创建API路由模块</span></span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">这里是挂载相关的路由</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// 挂载的get接口</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/get&#x27;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// 通过req.query来获取客户端查询的字符串，发送到服务器的数据</span></span><br><span class="line">    <span class="keyword">const</span> query = req.<span class="property">query</span>;</span><br><span class="line">    <span class="comment">// 发送请求</span></span><br><span class="line">    res.<span class="title function_">send</span>(&#123;</span><br><span class="line">        <span class="attr">status</span>:<span class="number">0</span>, <span class="comment">// 0代表处理成功，1代表处理失败</span></span><br><span class="line">        <span class="attr">msg</span>:<span class="string">&#x27;请求成功&#x27;</span>, <span class="comment">// 状态的描述</span></span><br><span class="line">        <span class="attr">data</span>:query   <span class="comment">// 响应给客户端的内容</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 挂载的post接口</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/post&#x27;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// 通过req.body获取请求体中包含的 url-encoded 格式的数据</span></span><br><span class="line">    <span class="keyword">const</span> body = req.<span class="property">body</span>;</span><br><span class="line">    <span class="comment">// 发送请求</span></span><br><span class="line">    res.<span class="title function_">send</span>(&#123;</span><br><span class="line">        <span class="attr">status</span>:<span class="number">0</span>, <span class="comment">// 0代表处理成功，1代表处理失败</span></span><br><span class="line">        <span class="attr">msg</span>:<span class="string">&#x27;请求成功&#x27;</span>, <span class="comment">// 状态的描述</span></span><br><span class="line">        <span class="attr">data</span>:body   <span class="comment">// 响应给客户端的内容</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure></div>

<h3 id="接口的跨越问题"><a href="#接口的跨越问题" class="headerlink" title="接口的跨越问题"></a>接口的跨越问题</h3><blockquote>
<p>解决接口跨域问题的方案主要有两种:</p>
</blockquote>
<ol>
<li>CORS(主流的解决方案，<font color="red">推荐使用</font>)</li>
<li>JSONP(有缺陷的解决方案:只支持GET请求</li>
</ol>
<h3 id="cors解决跨域"><a href="#cors解决跨域" class="headerlink" title="cors解决跨域"></a>cors解决跨域</h3><blockquote>
<p>cors 是 Express 的一个第三方中间件。通过安装和配置cors 中间件，可以很方便地解决跨域问题使用步骤分为如下3步:</p>
</blockquote>
<ul>
<li>运行 npm install cors 安装中间件</li>
<li>使用 const cors = require(cors) 导入中间件</li>
<li>在路由之前调用 app.use(cors()) 配置中间件</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="comment">// 配置解析表单数据的中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">urlencoded</span>(&#123;<span class="attr">extended</span>:<span class="literal">false</span>&#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定要在路由之前，配置 cors 这个中间件，从而解决接口跨域的问题</span></span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(cors);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cors</span>())</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入路由模块</span></span><br><span class="line"><span class="keyword">const</span> apiRouter = <span class="built_in">require</span>(<span class="string">&#x27;./14.创建api路由&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把路由模块，注册到app上</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/api&#x27;</span>,apiRouter)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">80</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;http://127.0.0.1&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<h2 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h2><blockquote>
<p>CORS(Cross-Origin Resource Sharing,跨域资源共享)由一系列 HTTP 响应头组成，这些 HTTP 响应头决定浏览器是否阻止前端JS 代码跨域获取资源</p>
</blockquote>
<p>浏览器的同源安全策略默认会阻止网页“跨域”获取资源。但如果接口服务器配置了 CORS 相关的 HTTP 响应头就可以解除浏览器端的跨域访问限制。</p>
<p><font color="blue"><strong>注意：</strong></font></p>
<ol>
<li>CORS 主要在服务器端进行配置。客户端浏览器无须做任何额外的配置，即可请求开启了 CORS 的接口</li>
<li>CORS 在浏览器中有兼容性。只有支持 XMLHttpRequest Level2 的浏览器，才能正常访问开启了 CORS 的服务端接口 (例如: IE10+、Chrome4+、FireFox3.5+)。</li>
</ol>
<h3 id="CORS-响应头部-Access-Control-Allow-Origin"><a href="#CORS-响应头部-Access-Control-Allow-Origin" class="headerlink" title="CORS 响应头部 - Access-Control-Allow-Origin"></a>CORS 响应头部 - Access-Control-Allow-Origin</h3><blockquote>
<p>响应头部中可以携带一个 Access-Control-Allow-Origin 字段</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Access</span>-<span class="title class_">Control</span>-<span class="title class_">Allow</span>-<span class="title class_">Origin</span>: &lt;origin&gt; | *</span><br></pre></td></tr></table></figure></div>
<p>其中，origin 参数的值指定了允许访问该资源的外域 URL<br>例如，下面的字段值将只允许来自 <a class="link"   target="_blank" rel="noopener" href="http://itcast.cn/" >http://itcast.cn <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> 的请求</p>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>,<span class="string">&quot;http://itcast.cn&#x27;)</span></span><br></pre></td></tr></table></figure></div>
<p>如果指定了 Access-Control-Allow-Origin 字段的值为通配符*，表示允许来自任何域的请求</p>
<h3 id="CORS-响应头部-Access-Control-Allow-Headers"><a href="#CORS-响应头部-Access-Control-Allow-Headers" class="headerlink" title="CORS 响应头部 - Access-Control-Allow-Headers"></a>CORS 响应头部 - Access-Control-Allow-Headers</h3><p>默认情况下，CORS 仅支持客户端向服务器发送如下的 9 个请求头:</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Accept、Accept-Language、Content-Language、 DPR、Downlink、Save-Data Viewport-Width、 Width 、</span><br><span class="line">Content-Type (值仅限于text/plain.multipart/form-data.</span><br><span class="line">application/x-www-form-urlencoded</span><br><span class="line">三者之一</span><br></pre></td></tr></table></figure></div>
<p>如果客户端向服务器发送了额外的请求头信息，则需要在服务器端，通过 Access-Control-Allow-Headers 对额外的请求头进行声明，否则这次请求会失败!</p>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 允许客户端额外向服务器发送 Content-Type 请求头和 X-Custom-Header 请求头</span></span><br><span class="line"><span class="comment">// 注意: 多个请求头之间使用英文的逗号进行分割</span></span><br><span class="line">res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Headers&#x27;</span>, <span class="string">&#x27;Content-Type, X-Custom-Header&#x27;</span>)</span><br></pre></td></tr></table></figure></div>

<h3 id="CORS-响应头部-Access-Control-Allow-Methods"><a href="#CORS-响应头部-Access-Control-Allow-Methods" class="headerlink" title="CORS 响应头部 - Access-Control-Allow-Methods"></a>CORS 响应头部 - Access-Control-Allow-Methods</h3><blockquote>
<p>默认情况下，CORS 仅支持客户端发起 GET、POST、HEAD 请求。<br>如果客户端希望通过 PUT、DELETE 等方式请求服务器的资源，则需要在服务器端，通过 Access-Control-Alow-Methods来指明实际请求所允许使用的 HTTP 方法。</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 只允许 POST、GET、DELETE、HEAD 请求方法</span></span><br><span class="line">res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Methods&#x27;</span>,<span class="string">&#x27;POST，GET，DELETE，HEAD&#x27;</span>)</span><br><span class="line"><span class="comment">//允许所有的 HTTP 请求方法</span></span><br><span class="line">res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Methods&#x27;</span>,<span class="string">&#x27;*&#x27;</span>)</span><br></pre></td></tr></table></figure></div>

<h3 id="CORS跨域资源分类"><a href="#CORS跨域资源分类" class="headerlink" title="CORS跨域资源分类"></a>CORS跨域资源分类</h3><blockquote>
<p>客户端在请求 CORS 接口时，根据请求方式和请求头的不同，可以将 CORS 的请求分为两大类，分别是:</p>
</blockquote>
<ol>
<li>简单请求<blockquote>
<p>同时满足以下两大条件的请求，就属于简单请求:</p>
</blockquote>
<ul>
<li>请求方式: GET、POST、HEAD 三者之一;</li>
<li>HTTP 头部信息不超过以下几种字段: 无自定义头部字段、Accept、Accept-Language、Content-Language、DPR.Downlink、Save-Data、Viewport-Width、Width .Content-Type(只有三个值application/x-www-form-urlencoded、multipart/form-data、text/plain);</li>
</ul>
</li>
<li>预检请求<blockquote>
<p>只要符合以下任何一个条件的请求，都需要进行预检请求:</p>
</blockquote>
<ul>
<li>请求方式为 GET、POST、HEAD 之外的请求 Method 类型</li>
<li>请求头中包含自定义头部字段</li>
<li>向服务器发送了 application/json 格式的数据</li>
</ul>
在浏览器与服务器正式通信之前，浏览器会先发送 OPTION 请求进行预检，以获知服务器是否允许该实际请求，所以这”。服务器成功响应预检请求后，才会发送真正的请求，并且携带真实数据次的OPTION请求称为“预检请求”</li>
</ol>
<h3 id="简单请求和预检请求的区别"><a href="#简单请求和预检请求的区别" class="headerlink" title="简单请求和预检请求的区别"></a>简单请求和预检请求的区别</h3><p>简单请求的特点: 客户端与服务器之间只会发生一次请求</p>
<p>预检请求的特点: 客户端与服务器之间会发生两次请求，OPTION 预检请求成功之后，才会发起真正的请求。</p>
<h2 id="JSONP接口"><a href="#JSONP接口" class="headerlink" title="JSONP接口"></a>JSONP接口</h2><blockquote>
<p>概念:浏览器端通过<script>标签的 src 属性，请求服务器上的数据，同时，服务器返回一个函数的调用。这种请求数据的方式叫做JSONP</p>
</blockquote>
<p>特点:</p>
<ul>
<li>JSONP不属于真正的Ajax 请求，因为它没有使用XMLHttpRequest这个对象</li>
<li>JSONP 仅支持 GET 请求，不支持 POST、PUT、DELETE 等请求</li>
</ul>
<p>如果项目中已经配置了 CORS 跨域资源共享，为了防止冲突，必须在配置 CORS 中间件之前声明JSONP 的接口。否则JSONP 接口会被处理成开启了 CORS的接口。</p>
<blockquote>
<p>实现jsonp接口实现步骤</p>
</blockquote>
<ul>
<li>获取客户端发送过来的回调函数的名字</li>
<li>得到要通过JSONP形式发送给客户端的数据</li>
<li>根据前两步得到的数据，拼接出一个函数调用的字符串</li>
<li>把上一步拼接得到的字符串，响应给客户端的<script>标签进行解析执行</li>
</ul>
<p><font color='red' size="15px">JSON.stringify:将数据对象转化为JSON对象</font></p>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="comment">// 配置解析表单数据的中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">urlencoded</span>(&#123;<span class="attr">extended</span>:<span class="literal">false</span>&#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 必须在cors之前配置jsonp的接口</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/api/jsonp&#x27;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// 定义jsonp接口具体的实现过程</span></span><br><span class="line">    <span class="comment">// 1. 得到函数的名称</span></span><br><span class="line">   <span class="keyword">const</span> funcName = req.<span class="property">query</span>.<span class="property">callback</span>;</span><br><span class="line">   <span class="comment">// 2.定义要发送到客户端的数据对象</span></span><br><span class="line">   <span class="keyword">const</span> data = &#123;<span class="attr">name</span>:<span class="string">&quot;zs&quot;</span>,<span class="attr">age</span>:<span class="number">124</span>&#125;;</span><br><span class="line">    <span class="comment">// 3.拼接出一个函数的调用</span></span><br><span class="line">    <span class="keyword">const</span> scriptStr = <span class="string">`<span class="subst">$&#123;funcName&#125;</span>(<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(data)&#125;</span>)`</span></span><br><span class="line">    <span class="comment">// 4。把拼接的字符串，响应给客户端</span></span><br><span class="line">    res.<span class="title function_">send</span>(scriptStr);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定要在路由之前，配置 cors 这个中间件，从而解决接口跨域的问题</span></span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(cors);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cors</span>())</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入路由模块</span></span><br><span class="line"><span class="keyword">const</span> apiRouter = <span class="built_in">require</span>(<span class="string">&#x27;./14.创建api路由&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把路由模块，注册到app上</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/api&#x27;</span>,apiRouter)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">80</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;http://127.0.0.1&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btnGET&quot;</span>&gt;</span>GET<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btnPOST&quot;</span>&gt;</span>POST<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btnDelete&quot;</span>&gt;</span>DELETE<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btnJSONP&quot;</span>&gt;</span>JSONP<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      $(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 1. 测试GET接口</span></span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&#x27;#btnGET&#x27;</span>).<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">type</span>: <span class="string">&#x27;GET&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">url</span>: <span class="string">&#x27;http://127.0.0.1/api/get&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">data</span>: &#123; <span class="attr">name</span>: <span class="string">&#x27;zs&#x27;</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">          &#125;)</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 2. 测试POST接口</span></span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&#x27;#btnPOST&#x27;</span>).<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">type</span>: <span class="string">&#x27;POST&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">url</span>: <span class="string">&#x27;http://127.0.0.1/api/post&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">data</span>: &#123; <span class="attr">bookname</span>: <span class="string">&#x27;水浒传&#x27;</span>, <span class="attr">author</span>: <span class="string">&#x27;施耐庵&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">          &#125;)</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 3. 为删除按钮绑定点击事件处理函数</span></span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&#x27;#btnDelete&#x27;</span>).<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">type</span>: <span class="string">&#x27;DELETE&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">url</span>: <span class="string">&#x27;http://127.0.0.1/api/delete&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">          &#125;)</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 4. 为 JSONP 按钮绑定点击事件处理函数</span></span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&#x27;#btnJSONP&#x27;</span>).<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">type</span>: <span class="string">&#x27;GET&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">url</span>: <span class="string">&#x27;http://127.0.0.1/api/jsonp&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">dataType</span>: <span class="string">&#x27;jsonp&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">          &#125;)</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">      &#125;)</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<h2 id="数据库与身份验证"><a href="#数据库与身份验证" class="headerlink" title="数据库与身份验证"></a>数据库与身份验证</h2><blockquote>
<p>数据库 (database)是用来组织、存储和管理数据的仓库</p>
</blockquote>
<p>当今世界是一个充满着数据的互联网世界，充斥着大量的数据。数据的来源有很多，比如出行记录、消费记录浏览的网页、发送的消息等等。除了文本类型的数据，图像、音乐、声音都是数据。</p>
<p>为了方便管理互联网世界中的数据，就有了数据库管理系统的概念(简称:数据库)。用户可以对数据库中的数据进行新增、查询、更新、删除等操作。</p>
<h3 id="常见的数据库及其分类"><a href="#常见的数据库及其分类" class="headerlink" title="常见的数据库及其分类"></a>常见的数据库及其分类</h3><ul>
<li>MySQL数据库 (目前使用最广泛、流行度最高的开源免费数据库;Community + Enterprise)</li>
<li>Oracle 数据库(收费)</li>
<li>SQL Server 数据库(收费)</li>
<li>Mongodb 数据库(Community + Enterprise)</li>
</ul>
<p>其中，MySQL、Oracle、SQL Server 属于传统型数据库 (又叫做: 关系型数据库或 SQL 数据库)，这三者的设计理念相同，用法比较类似。</p>
<p>而 Mongodb 属于新型数据库(又叫做: 非关系型数据库 或 NOSQL 数库)，它在一定程度上弥补了传统型数据库的缺陷。</p>
<h3 id="传统型数据库的数据组织结构"><a href="#传统型数据库的数据组织结构" class="headerlink" title="传统型数据库的数据组织结构"></a>传统型数据库的数据组织结构</h3><p>在传统型数据库中，数据的组织结构分为数据库(database)、数据表(table)、数据行(row)、字段(field)这 4 大部分组成</p>
<h3 id="实际开发中库、表、行、字段的关系"><a href="#实际开发中库、表、行、字段的关系" class="headerlink" title="实际开发中库、表、行、字段的关系"></a>实际开发中库、表、行、字段的关系</h3><ul>
<li>在实际项目开发中，一般情况下，每个项目都对应独立的数据库</li>
<li>不同的数据，要存储到数据库的不同表中，例如: 用户数据存储到 users 表中，图书数据存储到 books表中</li>
<li>每个表中具体存储哪些信息，由字段来决定，例如: 我们可以为 users 表设计 id、username、password这3个字段。、</li>
<li>表中的行，代表每一条具体的数据。</li>
</ul>
<h2 id="安装mysql"><a href="#安装mysql" class="headerlink" title="安装mysql"></a>安装mysql</h2><p>对于开发人员来说，只需要安装 MySQL Server 和 MySQL Workbench 这两个软件，就能满足开发的需要了</p>
<ul>
<li>MySQL Server: 专门用来提供数据存储和服务的软件</li>
<li>MySQL Workbench: 可视化的 MySQL 管理工具，通过它，可以方便的操作存储在 MySQL Server 中的数据.</li>
</ul>
<p><strong>问题：</strong></p>
<blockquote>
<p>安装MySQL可能遇到的问题及解决方案<br>端口被占用：<br>进入命令提示符</p>
</blockquote>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -ano|findstr 3306 </span><br></pre></td></tr></table></figure></div>
<p>查看哪个程序占用了3306端口,在任务管理器中结束该任务</p>
<p>参考安装教程 - Windows系统安装MySql</p>
<p>[]: 安装教程-Windows系统安装MySql</p>
<h2 id="mysqlworbeach基本使用"><a href="#mysqlworbeach基本使用" class="headerlink" title="mysqlworbeach基本使用"></a>mysqlworbeach基本使用</h2><h3 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="pic/%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93.png"
                      alt="连接数据库"
                ></p>
<h3 id="了解界面的组成部分"><a href="#了解界面的组成部分" class="headerlink" title="了解界面的组成部分"></a>了解界面的组成部分</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="pic/%E4%BA%86%E8%A7%A3%E7%95%8C%E9%9D%A2%E7%9A%84%E7%BB%84%E6%88%90%E9%83%A8%E5%88%86.png"
                      alt="了解界面的组成部分"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="pic/%E5%88%87%E6%8D%A2%E5%88%86%E5%8C%BA.png"
                      alt="切换分区"
                ></p>
<h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><p>不能包含中文和空格</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="pic/%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93.png"
                      alt="创建数据库"
                ></p>
<h3 id="创建数据表"><a href="#创建数据表" class="headerlink" title="创建数据表"></a>创建数据表</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="pic/%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E8%A1%A8.png"
                      alt="创建数据表"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="pic/%E8%AE%BE%E7%BD%AE%E5%AD%97%E6%AE%B5.png"
                      alt="设置字段"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="pic/%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B.png"
                      alt="字段类型"
                ></p>
<h3 id="向表中写入数据"><a href="#向表中写入数据" class="headerlink" title="向表中写入数据"></a>向表中写入数据</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="pic/%E5%90%91%E8%A1%A8%E4%B8%AD%E5%86%99%E5%85%A5%E6%95%B0%E6%8D%AE.png"
                      alt="向表中写入数据"
                ></p>
<h2 id="使用SQL管理数据库"><a href="#使用SQL管理数据库" class="headerlink" title="使用SQL管理数据库"></a>使用SQL管理数据库</h2><blockquote>
<p>SQL(英文全称: Structured Query Language) 是结构化查询语言，专门用来访问和处理数据库的编程语言。能够让我们以编程的形式，操作数据库里面的数据。</p>
</blockquote>
<p>三个点</p>
<ol>
<li> SQL 是一门数据库编程语言</li>
<li>使用SQL 语言编写出来的代码，叫做 SQL 语句</li>
<li>SQL语言只能在关系型数据库中使用 (例如 MySQL、Oracle、SQL Server)。非关系型数据库(例如 Mongodb)不支持 SQL语言</li>
</ol>
<p><em>能做什么？</em></p>
<ul>
<li>从数据库中查询数据</li>
<li>向数据库中插入新的数据</li>
<li>更新数据库中的数据</li>
<li>从数据库删除数</li>
<li>可以创建新数据库</li>
<li>可在数据库中创建新表</li>
<li>可在数据库中创建存储过程、视图</li>
<li>etc..</li>
</ul>
<p>重点掌握如何使用SQL从数据表中:</p>
<blockquote>
<p>查询数据 (select) 、删除数据 (delete)插入数据、(insert into)更新数据 (update)、<br>额外需要掌握的4种SQL 语法<br>where 条件、and 和 or 运算符、order by 排序、count()函数</p>
</blockquote>
<p><strong><font color="red" size=10px>select</font></strong><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="pic/select%E8%AF%AD%E6%B3%95.png"
                      alt="select语法"
                ></p>
<p>注意: SQL语句中的关键字对大小写不敏感。SELECT 等效于 select，FRQM 等效于 from</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 通过*把users表中的所有数据都查询出来</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>  users</span><br><span class="line"><span class="comment">-- 如需获取名为&quot;username&quot;和&quot;pasword&quot;的列的内容(从名为 users 的数据库表)，请使用下面的 SELECT 语句:</span></span><br><span class="line"><span class="keyword">select</span> username,password <span class="keyword">from</span> users</span><br></pre></td></tr></table></figure></div>

<p><strong><font color="red" size=10px>INSERT INTO</font></strong><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="pic/insert.png"
                      alt="insert"
                ></p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 向 users 表中，插入新数据，username 的值为 tony stark,password 的值为 000098123</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> users (username, password) <span class="keyword">values</span> (<span class="string">&#x27;tony stark&#x27;</span>,<span class="string">&#x27;000098123&#x27;</span>)</span><br></pre></td></tr></table></figure></div>

<p><strong><font color="red" size=10px>update</font></strong></p>
<blockquote>
<p>更新某一行中的一列</p>
</blockquote>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 把 users 表中id 为3的用户密码，更新为 888888。示例如下:</span></span><br><span class="line"><span class="keyword">update</span> users <span class="keyword">set</span> password <span class="operator">=</span> <span class="string">&#x27;888888&#x27;</span> <span class="keyword">where</span> id<span class="operator">=</span><span class="number">3</span></span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>更新某一行中的若干列</p>
</blockquote>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 把 users 表中id 为2的用户密码和用户状态，分别更新为 admin123 和1。示例如下:</span></span><br><span class="line"><span class="keyword">update</span> users <span class="keyword">set</span> password <span class="operator">=</span> <span class="string">&#x27;admin111&#x27;</span>,status <span class="operator">=</span> <span class="number">1</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">2</span></span><br></pre></td></tr></table></figure></div>


<p><strong><font color="red" size=10px>delete</font></strong><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="pic/delete.png"
                      alt="delete"
                ></p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 从 users 表中，删除 id 为4的用户，示例如下:</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">4</span></span><br></pre></td></tr></table></figure></div>


<p><strong><font color="red" size=10px>where</font></strong></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="pic/where%E8%AF%AD%E5%8F%A5.png"
                      alt="where语句"
                ></p>
<p>可以在where语句中使用运算符</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="pic/where%E4%BD%BF%E7%94%A8%E8%BF%90%E7%AE%97%E7%AC%A6.png"
                      alt="where使用运算符"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="pic/where%E4%BD%BF%E7%94%A8%E8%BF%90%E7%AE%97%E7%AC%A6-1.png"
                      alt="where使用运算符-1"
                ></p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> id <span class="operator">&gt;</span><span class="number">2</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> username<span class="operator">&lt;&gt;</span><span class="string">&#x27;ls&#x27;</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> username<span class="operator">!=</span><span class="string">&#x27;ls&#x27;</span></span><br></pre></td></tr></table></figure></div>

<p><strong><font color="red" size=10px>and  和 or</font></strong></p>
<p>AND 和 OR 可在 WHERE 子语句中把两个或多个条件结合起来<br>AND 表示必须同时满足多个条件，相当于 JavaScript 中的 &amp;&amp; 运算符，例如 if (a !== 10 &amp;&amp; a!== 20)<br>OR 表示只要满足任意一个条件即可，相当于 JavaScript 中的||运算符，例如 if(a !== 10 || a!== 20)</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> status<span class="operator">=</span><span class="number">0</span> <span class="keyword">and</span> id<span class="operator">&lt;</span><span class="number">3</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> status<span class="operator">=</span><span class="number">1</span> <span class="keyword">or</span> username<span class="operator">=</span><span class="string">&#x27;zs&#x27;</span></span><br></pre></td></tr></table></figure></div>


<p><strong><font color="red" size=10px>order by</font></strong></p>
<blockquote>
<p>ORDERBY语句用于根据指定的列对结果集进行排序;ORDERBY语句默认按照升序对记录进行排序;如果您希望按照降序对记录进行排序，可以使用 DESC关键字</p>
</blockquote>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 注意：以下两条 SOL 语句是等价时</span></span><br><span class="line"><span class="comment">-- 因为 ORDER BY 默认进行升序排序:</span></span><br><span class="line"><span class="comment">--其中， ASC 关键字代表升序排序</span></span><br><span class="line"><span class="comment">--其中， DESC 关键字代表降序排序</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">ORDER</span> <span class="keyword">BY</span> status;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">ORDER</span> <span class="keyword">BY</span> status <span class="keyword">ASC</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">ORDER</span> <span class="keyword">BY</span> id <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>多重排序</p>
</blockquote>
<p>对 users 表中的数据，先按照 status 进行降序排序，再按照 username 字母的顺序，进行升序的排序</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">order</span> <span class="keyword">by</span> status <span class="keyword">desc</span>,username <span class="keyword">asc</span></span><br></pre></td></tr></table></figure></div>

<p><strong><font color="red" size=10px>count * </font></strong></p>
<blockquote>
<p>COUNT(*)函数用于返回查询结果的总数据条数,语法格式：</p>
</blockquote>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>)<span class="keyword">FROM</span> 表名称</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 统计users状态为0的用户</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> users <span class="keyword">where</span> status <span class="operator">=</span> <span class="number">0</span></span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>AS关键字</p>
</blockquote>
<p>如果希望给查询出来的列名称设置别名，可以使用AS关键字</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 给列起别名</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> total <span class="keyword">from</span> users <span class="keyword">where</span> status <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">select</span> username <span class="keyword">as</span> name,password <span class="keyword">as</span> upwd <span class="keyword">from</span> users</span><br></pre></td></tr></table></figure></div>

<h2 id="在项目中操作mysql"><a href="#在项目中操作mysql" class="headerlink" title="在项目中操作mysql"></a>在项目中操作mysql</h2><ul>
<li>安装操作MySQL数据库的第三方模块 (mysql)</li>
<li>通过 mysql模块连接到 MySQL 数据库</li>
<li>通过 mysql模块执行 SQL 语句</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="pic/%E6%93%8D%E4%BD%9Cmysql.png"
                      alt="操作mysql"
                ></p>
<h3 id="安装mysql模块"><a href="#安装mysql模块" class="headerlink" title="安装mysql模块"></a>安装mysql模块</h3><blockquote>
<p>mysql 模块是托管于 npm上的第三方模块。它提供了在 Nodejs 项目中连接和操作 MySQL 数据库的能力.想要在项目中使用它，需要先运行如下命令，将mysql安装为项目的依赖包:</p>
</blockquote>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">初始化项目</span></span><br><span class="line">npm init -y</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装mysql</span></span><br><span class="line">npm i mysql</span><br></pre></td></tr></table></figure></div>

<h3 id="配置mysql模块"><a href="#配置mysql模块" class="headerlink" title="配置mysql模块"></a>配置mysql模块</h3><blockquote>
<p>在使用mysql模块操作MySQL数据库之前，必须先对 mysgl模块进行必要的配置，主要的配置步骤如下:</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 导入mysql</span></span><br><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 建立与mysql的联系</span></span><br><span class="line"><span class="keyword">const</span> db = mysql.<span class="title function_">createPool</span>(&#123;</span><br><span class="line">    <span class="attr">host</span>:<span class="string">&#x27;127.0.0.1&#x27;</span>,  <span class="comment">// 数据库的 IP地址</span></span><br><span class="line">    <span class="attr">user</span>:<span class="string">&#x27;root&#x27;</span>,    <span class="comment">// 数据库的用户名</span></span><br><span class="line">    <span class="attr">password</span>:<span class="string">&#x27;admin123&#x27;</span>,    <span class="comment">// 数据库的密码</span></span><br><span class="line">    <span class="attr">database</span>:<span class="string">&#x27;my_db_01&#x27;</span>      <span class="comment">// 指定要操作的那个数据库</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><blockquote>
<p>调用 db.query0函数，指定要执行的 SQL语句，通过回调函数拿到执行的结果</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入mysql</span></span><br><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 建立与mysql的联系</span></span><br><span class="line"><span class="keyword">const</span> db = mysql.<span class="title function_">createPool</span>(&#123;</span><br><span class="line">    <span class="attr">host</span>:<span class="string">&#x27;127.0.0.1&#x27;</span>,  <span class="comment">// 数据库的 IP地址</span></span><br><span class="line">    <span class="attr">user</span>:<span class="string">&#x27;root&#x27;</span>,    <span class="comment">// 数据库的用户名</span></span><br><span class="line">    <span class="attr">password</span>:<span class="string">&#x27;admin123&#x27;</span>,    <span class="comment">// 数据库的密码</span></span><br><span class="line">    <span class="attr">database</span>:<span class="string">&#x27;my_db_01&#x27;</span>      <span class="comment">// 指定要操作的那个数据库</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line">db.<span class="title function_">query</span>(<span class="string">&#x27;select 1&#x27;</span>,<span class="function">(<span class="params">err,results</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// mysql模块工作错了</span></span><br><span class="line">    <span class="keyword">if</span>(err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">message</span>);</span><br><span class="line">    <span class="comment">// 能够成功执行sql语句</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(results);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<h4 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h4><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> db = mysql.<span class="title function_">createPool</span>(&#123;</span><br><span class="line">  <span class="attr">host</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="comment">// 数据库的 IP 地址</span></span><br><span class="line">  <span class="attr">user</span>: <span class="string">&#x27;root&#x27;</span>, <span class="comment">// 登录数据库的账号</span></span><br><span class="line">  <span class="attr">password</span>: <span class="string">&#x27;admin123&#x27;</span>, <span class="comment">// 登录数据库的密码</span></span><br><span class="line">  <span class="attr">database</span>: <span class="string">&#x27;my_db_01&#x27;</span>, <span class="comment">// 指定要操作哪个数据库</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sqlStr = <span class="string">&#x27;select * from users&#x27;</span></span><br><span class="line">db.<span class="title function_">query</span>(sqlStr,<span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 询数据失败</span></span><br><span class="line">    <span class="keyword">if</span>(err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">message</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(results)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<h4 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h4><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> db = mysql.<span class="title function_">createPool</span>(&#123;</span><br><span class="line">  <span class="attr">host</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="comment">// 数据库的 IP 地址</span></span><br><span class="line">  <span class="attr">user</span>: <span class="string">&#x27;root&#x27;</span>, <span class="comment">// 登录数据库的账号</span></span><br><span class="line">  <span class="attr">password</span>: <span class="string">&#x27;admin123&#x27;</span>, <span class="comment">// 登录数据库的密码</span></span><br><span class="line">  <span class="attr">database</span>: <span class="string">&#x27;my_db_01&#x27;</span>, <span class="comment">// 指定要操作哪个数据库</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user = &#123;<span class="attr">username</span>:<span class="string">&quot;Spider-Man&quot;</span>,<span class="attr">password</span>:<span class="string">&quot;pcc123&quot;</span>&#125;</span><br><span class="line"><span class="keyword">const</span> sqlStr = <span class="string">&#x27;insert into users (username,password) values(?,?)&#x27;</span>;</span><br><span class="line">db.<span class="title function_">query</span>(sqlStr,[user.<span class="property">username</span>,user.<span class="property">password</span>],<span class="function">(<span class="params">err,results</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">message</span>)</span><br><span class="line">  <span class="comment">// results.affectedRows等于1代表语句执行成功</span></span><br><span class="line">  <span class="keyword">if</span>(results.<span class="property">affectedRows</span> === <span class="number">1</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;插入数据成功了&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>
<p>简写方式</p>
<blockquote>
<p>向表中新增数据时，如果数据对象的每个属性和数据表的字段一一对应</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> db = mysql.<span class="title function_">createPool</span>(&#123;</span><br><span class="line">  <span class="attr">host</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="comment">// 数据库的 IP 地址</span></span><br><span class="line">  <span class="attr">user</span>: <span class="string">&#x27;root&#x27;</span>, <span class="comment">// 登录数据库的账号</span></span><br><span class="line">  <span class="attr">password</span>: <span class="string">&#x27;admin123&#x27;</span>, <span class="comment">// 登录数据库的密码</span></span><br><span class="line">  <span class="attr">database</span>: <span class="string">&#x27;my_db_01&#x27;</span>, <span class="comment">// 指定要操作哪个数据库</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user = &#123;<span class="attr">username</span>:<span class="string">&quot;Spider-Man1&quot;</span>,<span class="attr">password</span>:<span class="string">&quot;pcc123456&quot;</span>&#125;</span><br><span class="line"><span class="keyword">const</span> sqlStr = <span class="string">&#x27;insert into users set ?&#x27;</span></span><br><span class="line">db.<span class="title function_">query</span>(sqlStr,user,<span class="function">(<span class="params">err,results</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">message</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(results.<span class="property">affectedRows</span> === <span class="number">1</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;插入数据成功了&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>
<h4 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h4><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> db = mysql.<span class="title function_">createPool</span>(&#123;</span><br><span class="line">  <span class="attr">host</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="comment">// 数据库的 IP 地址</span></span><br><span class="line">  <span class="attr">user</span>: <span class="string">&#x27;root&#x27;</span>, <span class="comment">// 登录数据库的账号</span></span><br><span class="line">  <span class="attr">password</span>: <span class="string">&#x27;admin123&#x27;</span>, <span class="comment">// 登录数据库的密码</span></span><br><span class="line">  <span class="attr">database</span>: <span class="string">&#x27;my_db_01&#x27;</span>, <span class="comment">// 指定要操作哪个数据库</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user = &#123;<span class="attr">id</span>:<span class="number">2</span>,<span class="attr">username</span>:<span class="string">&quot;aaa&quot;</span>,<span class="attr">password</span>:<span class="string">&#x27;root1234567&#x27;</span>&#125;</span><br><span class="line"><span class="keyword">const</span> sqlStr = <span class="string">&#x27;update users set username=?,password=? where id=?&#x27;</span></span><br><span class="line">db.<span class="title function_">query</span>(sqlStr,[user.<span class="property">username</span>,user.<span class="property">password</span>,user.<span class="property">id</span>],<span class="function">(<span class="params">err,results</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">message</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(results.<span class="property">affectedRows</span> === <span class="number">1</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;更新成功&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>
<p>简写操作</p>
<blockquote>
<p>更新表数据时，如果数据对象的每个属性和数据表的字段一一对应，则可以通过如下方式快速更新表数据</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> db = mysql.<span class="title function_">createPool</span>(&#123;</span><br><span class="line">  <span class="attr">host</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="comment">// 数据库的 IP 地址</span></span><br><span class="line">  <span class="attr">user</span>: <span class="string">&#x27;root&#x27;</span>, <span class="comment">// 登录数据库的账号</span></span><br><span class="line">  <span class="attr">password</span>: <span class="string">&#x27;admin123&#x27;</span>, <span class="comment">// 登录数据库的密码</span></span><br><span class="line">  <span class="attr">database</span>: <span class="string">&#x27;my_db_01&#x27;</span>, <span class="comment">// 指定要操作哪个数据库</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user = &#123;<span class="attr">id</span>:<span class="number">3</span>,<span class="attr">username</span>:<span class="string">&quot;abc&quot;</span>,<span class="attr">password</span>:<span class="string">&#x27;root167&#x27;</span>&#125;</span><br><span class="line"><span class="keyword">const</span> sqlStr = <span class="string">&#x27;update users set ? where id=?&#x27;</span></span><br><span class="line">db.<span class="title function_">query</span>(sqlStr,[user,user.<span class="property">id</span>],<span class="function">(<span class="params">err,results</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">message</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(results.<span class="property">affectedRows</span> === <span class="number">1</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;更新成功&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>
<h4 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h4><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> db = mysql.<span class="title function_">createPool</span>(&#123;</span><br><span class="line">  <span class="attr">host</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="comment">// 数据库的 IP 地址</span></span><br><span class="line">  <span class="attr">user</span>: <span class="string">&#x27;root&#x27;</span>, <span class="comment">// 登录数据库的账号</span></span><br><span class="line">  <span class="attr">password</span>: <span class="string">&#x27;admin123&#x27;</span>, <span class="comment">// 登录数据库的密码</span></span><br><span class="line">  <span class="attr">database</span>: <span class="string">&#x27;my_db_01&#x27;</span>, <span class="comment">// 指定要操作哪个数据库</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sqlStr = <span class="string">&#x27;delete from users where id=?&#x27;</span></span><br><span class="line">db.<span class="title function_">query</span>(sqlStr,<span class="number">2</span>,<span class="function">(<span class="params">err,results</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">message</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(results.<span class="property">affectedRows</span> === <span class="number">1</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;删除成功&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>
<h4 id="标记删除"><a href="#标记删除" class="headerlink" title="标记删除"></a>标记删除</h4><blockquote>
<p>使用 DELETE 语句，会把真正的把数据从表中删除掉。为了保险起见，推荐使用标记删除的形式，来模拟删除的动作。</p>
</blockquote>
<p>所谓的标记删除，就是在表中设置类似于 status 这样的状态字段，来标记当前这条数据是否被删除.当用户执行了删除的动作时，我们并没有执行 DELETE 语句把数据删除掉，而是执行了UPDATE 语句，将这条数据对应的status字段标记为删除即可</p>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> db = mysql.<span class="title function_">createPool</span>(&#123;</span><br><span class="line">  <span class="attr">host</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="comment">// 数据库的 IP 地址</span></span><br><span class="line">  <span class="attr">user</span>: <span class="string">&#x27;root&#x27;</span>, <span class="comment">// 登录数据库的账号</span></span><br><span class="line">  <span class="attr">password</span>: <span class="string">&#x27;admin123&#x27;</span>, <span class="comment">// 登录数据库的密码</span></span><br><span class="line">  <span class="attr">database</span>: <span class="string">&#x27;my_db_01&#x27;</span>, <span class="comment">// 指定要操作哪个数据库</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> sqlStr = <span class="string">&#x27;update users set status=? where id=?&#x27;</span></span><br><span class="line">db.<span class="title function_">query</span>(sqlStr,[<span class="number">1</span>,<span class="number">3</span>],<span class="function">(<span class="params">err,results</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">message</span>)</span><br><span class="line">  <span class="keyword">if</span>(results.<span class="property">affectedRows</span> === <span class="number">1</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;标记删除成功&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<h2 id="web开发模式"><a href="#web开发模式" class="headerlink" title="web开发模式"></a>web开发模式</h2><p>目前主流的 Web 开发模式有两种，分别是:</p>
<ul>
<li><p>基于服务端染的传统 Web 开发模式</p>
<blockquote>
<p>服务端渲染的概念:服务器发送给客户端的 HTML 页面，是在服务器通过字符串的拼接，动态生成的。因此，客户端不需要使用Ajax这样的技术额外请求页面的数据。代码示例如下:<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="pic/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93.png"
                      alt="服务端渲染"
                ></p>
</blockquote>
<p>优点:</p>
<ul>
<li>前端耗时少。因为服务器端负责动态生成 HTML内容，浏览器只需要直接染页面即可。尤其是移动端，更省电</li>
<li>有利于SEO。因为服务器端响应的是完整的 HTML页面内容，所以爬虫更容易爬取获得信息，更有利于 SEO。<br>缺点:</li>
<li>占用服务器端资源。即服务器端完成 HTML 页面内容的拼接，如果请求较多，会对服务器造成一定的访问压力.</li>
<li>不利于前后端分离，开发效率低。使用服务器端渲染，则无法进行分工合作，尤其对于前端复杂度高的项目，不利于项目高效开发。  </li>
</ul>
</li>
<li><p>基于前后端分离的新型 Web 开发横式</p>
<blockquote>
<p>前后端分离的概念:前后端分离的开发模式，依赖于 Ajax 技术的广泛应用。简而言之，前后端分离的 Web 开发模式就是后端只负责提供 API 接口，前端使用 Ajax 调用接口的开发模式。<br>优点:</p>
<ul>
<li>开发体验好。前端专注于UI页面的开发，后端专注于api的开发，且前端有更多的选择性</li>
<li>用户体验好。Ajax技术的广泛应用，极大的提高了用户的体验，可以轻松实现页面的局部刷新</li>
<li>减轻了服务器端的渲染压力。因为页面最终是在每个用户的浏览器中生成的。<br>缺点:</li>
<li>不利于 SEO。因为完整的 HTML 页面需要在客户端动态拼接完成，所以爬虫对无法爬取页面的有效信息。解决方案:利用 Vue、React 等前端框架的 SSR (server side render) 技术能够好的解决 SEO 问题!</li>
</ul>
</blockquote>
</li>
</ul>
<h3 id="如何选择web开发模式"><a href="#如何选择web开发模式" class="headerlink" title="如何选择web开发模式"></a>如何选择web开发模式</h3><ul>
<li>比如企业级网站，主要功能是展示而没有复杂的交互，并且需要良好的 SEO，则这时我们就需要使用服务器端渲染</li>
<li>而类似后台管理项目，交互性比较强，不需要考虑SEO，那么就可以使用前后端分离的开发模式。</li>
</ul>
<p>首屏服务器端渲染+其他页面前后端分离的开发模式另外，具体使用何种开发模式并不是绝对的，为了同时兼顾了首页的渲染速度和前后端分离的开发效率，一些网站采用了</p>
<h2 id="身份认证"><a href="#身份认证" class="headerlink" title="身份认证"></a>身份认证</h2><blockquote>
<p>身份认证 (Authentication) 又称“身份验证”“鉴权”，是指通过一定的手段，完成对用户身份的确认</p>
</blockquote>
<ul>
<li>日常生活中的身份认证随处可见，例如:高铁的验票乘车，手机的密码或指纹解锁，支付宝或微信的支付密码等</li>
<li>在 Web 开发中，也涉及到用户身份的认证，例如: 各大网站的手机验证码登录、邮箱密码登录、二维码登录等.</li>
</ul>
<h3 id="为什么需要身份认证"><a href="#为什么需要身份认证" class="headerlink" title="为什么需要身份认证"></a>为什么需要身份认证</h3><blockquote>
<p>身份认证的目的，是为了确认当前所声称为某种身份的用户，确实是所声称的用户。例如，你去找快递员取快递，你要怎么证明这份快递是你的。</p>
</blockquote>
<h3 id="不同开发者模式下的身份验证"><a href="#不同开发者模式下的身份验证" class="headerlink" title="不同开发者模式下的身份验证"></a>不同开发者模式下的身份验证</h3><p>对于服务端渲染和前后端分离这两种开发模式来说，分别有着不同的身份认证方案</p>
<ul>
<li>服务端染推荐使用 Session 认证机制</li>
<li>前后端分离推荐使用JWT 认证机制</li>
</ul>
<h2 id="session原理"><a href="#session原理" class="headerlink" title="session原理"></a>session原理</h2><h3 id="HTTP的无状态性"><a href="#HTTP的无状态性" class="headerlink" title="HTTP的无状态性"></a>HTTP的无状态性</h3><blockquote>
<p>了解 HTTP 协议的无状态性是进一步学习 Session 认证机制的必要前提HTTP 协议的无状态性，指的是客户端的每次 HTTP 请求都是独立的，连续多个请求之间没有直接的关系，服务器不会主动保留每次 HTTP 请求的状态</p>
</blockquote>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="pic/http%E6%97%A0%E7%8A%B6%E6%80%81%E6%80%A7.png"
                      alt="http无状态性"
                ></p>
<h3 id="如何突破http的无状态性"><a href="#如何突破http的无状态性" class="headerlink" title="如何突破http的无状态性"></a>如何突破http的无状态性</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="pic/%E7%AA%81%E7%A0%B4http%E6%97%A0%E7%8A%B6%E6%80%81%E6%80%A7.png"
                      alt="突破http的无状态性"
                ></p>
<h3 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h3><blockquote>
<p>Cookie 是存储在用户浏览器中的一段不超过 4 KB 的字符串。它由一个名称(Name) 、一个值(Value) 和其它几个用于控制 Cookie 有效期、安全性、使用范围的可选属性组成。</p>
</blockquote>
<p>不同域名下的 Cookie 各自独立，每当客户端发起请求时，会自动把当前域名下所有未过期的 Cookie 一同发送到服务器.</p>
<p>特点：</p>
<ul>
<li>自动发送</li>
<li>域名独立</li>
<li>过期时限</li>
<li>4KB限制</li>
</ul>
<h3 id="cookie的作用"><a href="#cookie的作用" class="headerlink" title="cookie的作用"></a>cookie的作用</h3><blockquote>
<p>客户端第一次请求服务器的时候，服务器通过响应头的形式，向客户端发送一个身份认证的 Cookie，客户端会自动将 Cookie 保存在浏览器中。<br>随后，当客户端浏览器每次请求服务器的时候，浏览器会自动将身份认证相关的 Cookie，通过请求头的形式发送给服务器，服务器即可验明客户端的身份。<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="pic/cookie%E7%9A%84%E4%BD%9C%E7%94%A8.png"
                      alt="cookie的作用"
                ></p>
</blockquote>
<h3 id="cookie不具有安全性"><a href="#cookie不具有安全性" class="headerlink" title="cookie不具有安全性"></a>cookie不具有安全性</h3><blockquote>
<p>由于 Cookie 是存储在浏览器中的，而且浏览器也提供了读写 Cookie 的 AP1，因此 Cookie 很容易被伪造，不具有安全性。因此不建议服务器将重要的隐私数据，通过Cookie 的形式发送给浏览器<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="pic/cookie%E4%B8%8D%E5%AE%89%E5%85%A8%E6%80%A7.png"
                      alt="cookie不安全性"
                ></p>
</blockquote>
<p>注意:千万不要使用 Cookie 存储重要且隐私的数据!比如用户的身份信息、密码等</p>
<h3 id="提高身份认证的安全性"><a href="#提高身份认证的安全性" class="headerlink" title="提高身份认证的安全性"></a>提高身份认证的安全性</h3><blockquote>
<p>为了防止客户伪造会员卡，收银员在拿到客户出示的会员卡之后，可以在收银机上进行刷卡认证。只有收银机确认存在的会员卡，才能被正常使用</p>
</blockquote>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="pic/%E6%8F%90%E9%AB%98%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7.png"
                      alt="提高身份认证的安全性"
                ></p>
<p>这种“会员卡 +刷卡认证”的设计理念，就是 Session 认证机制的精髓</p>
<h3 id="session的工作原理"><a href="#session的工作原理" class="headerlink" title="session的工作原理"></a>session的工作原理</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="pic/session%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.png"
                      alt="session的工作原理"
                ></p>
<h3 id="session中的中间件使用"><a href="#session中的中间件使用" class="headerlink" title="session中的中间件使用"></a>session中的中间件使用</h3><ol>
<li>安装express-session中间件<blockquote>
<p>在 Express 项目中，只需要安装 express-session 中间件，即可在项目中使用 Session 认证:</p>
 <div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express-session</span><br></pre></td></tr></table></figure></div></blockquote>
</li>
<li>配置express-session 中间件<blockquote>
<p>express-session 中间件安装成功后，需要通过 app.use() 来注册 session 中间件,示例代码如下</p>
 <div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.导入 session 中间件</span></span><br><span class="line"><span class="keyword">var</span> session = <span class="built_in">require</span>( <span class="string">&#x27;express-session&#x27;</span>)</span><br><span class="line"><span class="comment">// 2.配置 Session 中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">session</span>(&#123;</span><br><span class="line">    <span class="attr">secret</span>:<span class="string">&#x27;keyboard cat&#x27;</span>,<span class="comment">// secret 属性的值可以为任意字符串</span></span><br><span class="line">    <span class="attr">resave</span>: <span class="literal">false</span>,<span class="comment">// 固定写法</span></span><br><span class="line">    <span class="attr">saveUninitialized</span>: <span class="literal">true</span> <span class="comment">// 固定写法</span></span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure></div></blockquote>
</li>
<li>向express中存数据<blockquote>
<p>当express-session 中间件配置成功后，即可通过 req,session 来访问和使用sesion 对象，从而存储用户的关键信息:</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"> <span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"> <span class="comment">// 1.导入 session 中间件</span></span><br><span class="line"> <span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">&#x27;express-session&#x27;</span>)</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 2.配置 Session 中间件</span></span><br><span class="line"> app.<span class="title function_">use</span>(<span class="title function_">session</span>(&#123;</span><br><span class="line">     <span class="attr">secret</span>: <span class="string">&#x27;keyboard cat&#x27;</span>,<span class="comment">// secret 属性的值可以为任意字符串</span></span><br><span class="line">     <span class="attr">resave</span>: <span class="literal">false</span>,<span class="comment">// 固定写法</span></span><br><span class="line">     <span class="attr">saveUninitialized</span>: <span class="literal">true</span> <span class="comment">// 固定写法</span></span><br><span class="line"> &#125;))</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 登录的 API 接口</span></span><br><span class="line"> app.<span class="title function_">post</span>(<span class="string">&#x27;/api/login&#x27;</span>, <span class="function">(<span class="params">req, res</span>)=&gt;</span>&#123;</span><br><span class="line">     <span class="comment">// 判断用户提交的登录信息是否正确</span></span><br><span class="line">     <span class="keyword">if</span> (req.<span class="property">body</span>.<span class="property">username</span> !== <span class="string">&#x27;admin&#x27;</span> || req.<span class="property">body</span>.<span class="property">password</span> !== <span class="string">&#x27;000000&#x27;</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> res.<span class="title function_">send</span>(&#123; <span class="attr">status</span>: <span class="number">1</span>, <span class="attr">msg</span>: <span class="string">&#x27;登录失败&#x27;</span> &#125;)</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     <span class="comment">// TODO_02: 请将登录成功后的用户信息，保存到 Session</span></span><br><span class="line">     <span class="comment">// 注意: 只有成功配置了 express-session 这个中间件之后，才能够通过 req 点出来 session 这个属性</span></span><br><span class="line">     req.<span class="property">session</span>.<span class="property">user</span> = req.<span class="property">body</span>;  <span class="comment">// 用户信息</span></span><br><span class="line">     req.<span class="property">session</span>.<span class="property">islogin</span> = <span class="literal">true</span>;  <span class="comment">// 用户的登录状态</span></span><br><span class="line">     res.<span class="title function_">send</span>(&#123; <span class="attr">status</span>: <span class="number">0</span>, <span class="attr">msg</span>: <span class="string">&#x27;登录成功&#x27;</span> &#125;)</span><br><span class="line"> &#125;)</span><br></pre></td></tr></table></figure></div></li>
</ol>
<pre><code>app.listen(80, () =&gt; &#123;
    console.log(&#39;127.0.0.1&#39;)
&#125;)
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">4. 从session中取数据</span><br><span class="line">    &gt; 可以直接从 req.session 对象上获取之前存储的数据，示例代码如下</span><br><span class="line">    ```js</span><br><span class="line">    const express = require(&#x27;express&#x27;);</span><br><span class="line">    const app = express();</span><br><span class="line">    // 1.导入 session 中间件</span><br><span class="line">    const session = require(&#x27;express-session&#x27;)</span><br><span class="line"></span><br><span class="line">    // 2.配置 Session 中间件</span><br><span class="line">    app.use(session(&#123;</span><br><span class="line">        secret: &#x27;keyboard cat&#x27;,// secret 属性的值可以为任意字符串</span><br><span class="line">        resave: false,// 固定写法</span><br><span class="line">        saveUninitialized: true // 固定写法</span><br><span class="line">    &#125;))</span><br><span class="line"></span><br><span class="line">    // 登录的 API 接口</span><br><span class="line">    app.post(&#x27;/api/login&#x27;, (req, res)=&gt;&#123;</span><br><span class="line">        // 判断用户提交的登录信息是否正确</span><br><span class="line">        if (req.body.username !== &#x27;admin&#x27; || req.body.password !== &#x27;000000&#x27;) &#123;</span><br><span class="line">            return res.send(&#123; status: 1, msg: &#x27;登录失败&#x27; &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        // TODO_02: 请将登录成功后的用户信息，保存到 Session</span><br><span class="line">        // 注意: 只有成功配置了 express-session 这个中间件之后，才能够通过 req 点出来 session 这个属性</span><br><span class="line">        req.session.user = req.body;  // 用户信息</span><br><span class="line">        req.session.islogin = true;  // 用户的登录状态</span><br><span class="line">        res.send(&#123; status: 0, msg: &#x27;登录成功&#x27; &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    app.get(&#x27;/api/username&#x27;,(req,res)=&gt;&#123;</span><br><span class="line">        if(!req.session.islogin)&#123;</span><br><span class="line">            return res.send(&#123;status:1,msg:&quot;fail&quot;&#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        res.send(&#123;</span><br><span class="line">            status:0,</span><br><span class="line">            msg:&#x27;success&#x27;,</span><br><span class="line">            username:req.session.user.username</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    app.listen(80, () =&gt; &#123;</span><br><span class="line">        console.log(&#x27;127.0.0.1&#x27;)</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure></div>
</code></pre>
<ol start="5">
<li>清空session<blockquote>
<p>调用 req.session.destroy()函数，即可清空服务器保存的 session 信息</p>
 <div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="comment">// 1.导入 session 中间件</span></span><br><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">&#x27;express-session&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.配置 Session 中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(</span><br><span class="line">    <span class="title function_">session</span>(&#123;</span><br><span class="line">    <span class="attr">secret</span>: <span class="string">&#x27;keyboard cat&#x27;</span>,<span class="comment">// secret 属性的值可以为任意字符串</span></span><br><span class="line">    <span class="attr">resave</span>: <span class="literal">false</span>,<span class="comment">// 固定写法</span></span><br><span class="line">    <span class="attr">saveUninitialized</span>: <span class="literal">true</span> <span class="comment">// 固定写法</span></span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 托管静态页面</span></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(<span class="string">&#x27;./pages&#x27;</span>))</span><br><span class="line"><span class="comment">// 解析 POST 提交过来的表单数据</span></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">urlencoded</span>(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;))</span><br></pre></td></tr></table></figure></div></blockquote>
</li>
</ol>
<pre><code>// 登录的 API 接口
app.post(&#39;/api/login&#39;, (req, res)=&gt;&#123;
    // 判断用户提交的登录信息是否正确
    if (req.body.username !== &#39;admin&#39; || req.body.password !== &#39;000000&#39;) &#123;
        return res.send(&#123; status: 1, msg: &#39;登录失败&#39; &#125;)
    &#125;

    // TODO_02: 请将登录成功后的用户信息，保存到 Session
    // 注意: 只有成功配置了 express-session 这个中间件之后，才能够通过 req 点出来 session 这个属性
    req.session.user = req.body;  // 用户信息
    req.session.islogin = true;  // 用户的登录状态
    res.send(&#123; status: 0, msg: &#39;登录成功&#39; &#125;)
&#125;)

app.get(&#39;/api/username&#39;,(req,res)=&gt;&#123;
    if(!req.session.islogin)&#123;
        return res.send(&#123;status:1,msg:&quot;fail&quot;&#125;)
    &#125;
    res.send(&#123;
        status:0,
        msg:&#39;success&#39;,
        username:req.session.user.username
    &#125;)
&#125;)

app.post(&#39;/api/logout&#39;,(req,res)=&gt;&#123;
    req.session.destroy();
    res.send(&#123;
        status:0,
        msg:&quot;退出登录成功&quot;,
    &#125;)
&#125;)

app.listen(80, () =&gt; &#123;
    console.log(&#39;http://127.0.0.1:80&#39;)
&#125;)
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## JWT验证机制</span><br><span class="line"></span><br><span class="line">### 了解session的认证局限性</span><br><span class="line">&gt; Session 认证机制需要配合 Cookie 才能实现。由于 Cookie 默认不支持跨域访问，所以，当涉及到前端跨域请求后端接口的时候，需要做很多额外的配置，才能实现跨域 Sssion 认证。</span><br><span class="line"></span><br><span class="line">### 什么是JWT</span><br><span class="line">&gt; JWT(英文全称:JSON Web Token) 是目前最流行的跨域认证解决方案</span><br><span class="line"></span><br><span class="line">### JWT的工作原理</span><br><span class="line"></span><br><span class="line">![JWT的工作原理](pic/JWT的工作原理.png)</span><br><span class="line"></span><br><span class="line">&gt; 总结:用户的信息通过 Token 字符串的形式，保存在客户端测览器中。服务器通过还原 Token 字符串的形式来认证用户的身份。</span><br><span class="line"></span><br><span class="line">### JWY的组成部分</span><br><span class="line"></span><br><span class="line">&gt; Signature (签名)JWT 通常由三部分组成，分别是 Header (头部)、Payload (有效荷载)、三者之间使用英文的“”分隔，格式如下:</span><br></pre></td></tr></table></figure></div>
</code></pre>
<p>Header.Payload.Signature</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">实例：</span><br></pre></td></tr></table></figure></div>
<p>3N3b3Jkrioiliwibmlia25YUBpdGNhc30uY24iLCJ1c2VVX.3BpYvI6IiIsImlhdCI6MTU30DAZNiY4MiwNrtMG0411KdZ33S9KBL3XeuBxul.yJhbbhuioilZXhwIioxNTc4MDCYN</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">JWT的三个组成部分，从前到后分别是 Header、Payload、Signature</span><br><span class="line">其中:</span><br><span class="line">- Payload 部分才是真正的用户信息，它是用户信息经过加密之后生成的字符串</span><br><span class="line">- Header 和 Signature 是安全性相关的部分，只是为了保证 Token 的安全性</span><br><span class="line"></span><br><span class="line">![JWT机制](pic/JWT机制.png)</span><br><span class="line"></span><br><span class="line">### JWT的使用方式</span><br><span class="line">&gt; 客户端收到服务器返回的JWT 之后，通常会将它储存在 localStorage 或 sessionStorage 中</span><br><span class="line">&gt; 此后，客户端每次与服务器通信，都要带上这个JWT 的符串，从而进行身份认证。推荐的做法是把JWT 放在 HTTP请求头的 Authorization 字段中，格式如下:</span><br></pre></td></tr></table></figure></div>
<p>Authorization: Bearer<token></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 在express中使用JWT</span><br><span class="line"></span><br><span class="line">#### 安装JTW相关的包</span><br><span class="line">```shell</span><br><span class="line">npm install jsonwebtoken express-jwt</span><br></pre></td></tr></table></figure></div>
<ul>
<li>jsonwebtoken用户生成JWT字符串、</li>
<li>express-jwt用户将JTW字符串解析还原成JSON对象</li>
</ul>
<h4 id="导入JTW相关的包"><a href="#导入JTW相关的包" class="headerlink" title="导入JTW相关的包"></a>导入JTW相关的包</h4><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.导入用于生成 JWT 字符串的包</span></span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>( <span class="string">&#x27;jsonwebtoken&#x27;</span> )</span><br><span class="line"><span class="comment">// 2.导入用于将客户端发送过来的 JWT 字符串，解析还原成 JSON 对象的包</span></span><br><span class="line"><span class="keyword">const</span> expressJWT = <span class="built_in">require</span>(<span class="string">&#x27;express-jwt&#x27;</span>)</span><br></pre></td></tr></table></figure></div>

<h4 id="定义secret密钥"><a href="#定义secret密钥" class="headerlink" title="定义secret密钥"></a>定义secret密钥</h4><blockquote>
<p>为了保证JWT 字符串的安全性，防止WT 字符串在网络传输过程中被别人破解，我们需要专门定义一个用于加密和解密的 secret 密钥:</p>
</blockquote>
<ul>
<li>当生成JWT 字符串的时候，<br>需要使用secret密钥对用户的信息进行加密，最终得到加密好的JWT字符串</li>
<li>当把JWT字符串解析还原成JSON对象的时候，需要使用secret 密进行解密<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义 secret 密钥，建议将密钥命名为 secretKey</span></span><br><span class="line"><span class="keyword">const</span> secretKey = <span class="string">&#x27;zhoghou No1 ^-^&#x27;</span></span><br></pre></td></tr></table></figure></div></li>
</ul>
<h4 id="在登录成功后生成JWT字符串"><a href="#在登录成功后生成JWT字符串" class="headerlink" title="在登录成功后生成JWT字符串"></a>在登录成功后生成JWT字符串</h4><blockquote>
<p>调用jsonwebtoken 包提供的 sign0 方法，将用户的信息加密成JWT 字符串，响应给客户端</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 参数1：用户的信息对象</span></span><br><span class="line"><span class="comment">// 参数2：加密的秘钥</span></span><br><span class="line"><span class="comment">// 参数3：配置对象，可以配置当前 token 的有效期</span></span><br><span class="line"><span class="comment">// 记住：千万不要把密码加密到 token 字符中</span></span><br><span class="line"><span class="keyword">const</span> tokenStr = jwt.<span class="title function_">sign</span>(&#123;<span class="attr">username</span>:userinfo.<span class="property">username</span>&#125;,secretKey,&#123;<span class="attr">expiresIn</span>:<span class="string">&#x27;30s&#x27;</span>&#125;);</span><br><span class="line">res.<span class="title function_">send</span>(&#123;</span><br><span class="line">  <span class="attr">status</span>: <span class="number">200</span>,</span><br><span class="line">  <span class="attr">message</span>: <span class="string">&#x27;登录成功！&#x27;</span>,</span><br><span class="line">  <span class="attr">token</span>: tokenStr, <span class="comment">// 要发送给客户端的 token 字符串</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<h4 id="将JWT字符串还原成JSON对象"><a href="#将JWT字符串还原成JSON对象" class="headerlink" title="将JWT字符串还原成JSON对象"></a>将JWT字符串还原成JSON对象</h4><blockquote>
<p>客户端每次在访问那些有权限接口的时候，都需要主动通过请求头中的 Authorization 字段，将Token 字符串发送到服务器进行身份认证。<br>此时，服务器可以通过express-jwt 这个中间件自动将客户端发送过来的 Token 解析还原成JSON对象</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TODO_04：注册将 JWTad字符串解析还原成 JSON 对象的中间件</span></span><br><span class="line"><span class="comment">// 注意：只要配置成功了 express-jwt 这个中间件，就可以把解析出来的用户信息，挂载到 req.user 属性上</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">expressJWT</span>(&#123;</span><br><span class="line">  <span class="attr">secret</span>: secretKey,</span><br><span class="line">&#125;).<span class="title function_">unless</span>(&#123; <span class="attr">path</span>: [<span class="regexp">/^\/apo\//</span>] &#125;))</span><br></pre></td></tr></table></figure></div>
<h4 id="使用req-user获取用户信息"><a href="#使用req-user获取用户信息" class="headerlink" title="使用req.user获取用户信息"></a>使用req.user获取用户信息</h4><blockquote>
<p>当express-jwt 这个中间件配置成功之后，即可在那些有权限的接口中，使用req.user 对象，来访问从JWT 字符串中解析出来的用户信息了，示例代码如下:</p>
</blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入 express 模块</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">// 创建 express 的服务器实例</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO_01：安装并导入 JWT 相关的两个包，分别是 jsonwebtoken 和 express-jwt</span></span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> expressJWT = <span class="built_in">require</span>(<span class="string">&#x27;express-jwt&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 允许跨域资源共享</span></span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&#x27;cors&#x27;</span>)</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cors</span>())</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解析 post 表单数据的中间件</span></span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>)</span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">urlencoded</span>(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO_02：定义 secret 密钥，建议将密钥命名为 secretKey</span></span><br><span class="line"><span class="keyword">const</span> secretKey = <span class="string">&#x27;itheima No1 ^_^&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO_04：注册将 JWT 字符串解析还原成 JSON 对象的中间件</span></span><br><span class="line"><span class="comment">// 注意：只要配置成功了 express-jwt 这个中间件，就可以把解析出来的用户信息，挂载到 req.user 属性上</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">expressJWT</span>(&#123; <span class="attr">secret</span>: secretKey &#125;).<span class="title function_">unless</span>(&#123; <span class="attr">path</span>: [<span class="regexp">/^\/api\//</span>] &#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 登录接口</span></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/api/login&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="comment">// 将 req.body 请求体中的数据，转存为 userinfo 常量</span></span><br><span class="line">  <span class="keyword">const</span> userinfo = req.<span class="property">body</span></span><br><span class="line">  <span class="comment">// 登录失败</span></span><br><span class="line">  <span class="keyword">if</span> (userinfo.<span class="property">username</span> !== <span class="string">&#x27;admin&#x27;</span> || userinfo.<span class="property">password</span> !== <span class="string">&#x27;000000&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">send</span>(&#123;</span><br><span class="line">      <span class="attr">status</span>: <span class="number">400</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;登录失败！&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 登录成功</span></span><br><span class="line">  <span class="comment">// TODO_03：在登录成功之后，调用 jwt.sign() 方法生成 JWT 字符串。并通过 token 属性发送给客户端</span></span><br><span class="line">  <span class="comment">// 参数1：用户的信息对象</span></span><br><span class="line">  <span class="comment">// 参数2：加密的秘钥</span></span><br><span class="line">  <span class="comment">// 参数3：配置对象，可以配置当前 token 的有效期</span></span><br><span class="line">  <span class="comment">// 记住：千万不要把密码加密到 token 字符中</span></span><br><span class="line">  <span class="keyword">const</span> tokenStr = jwt.<span class="title function_">sign</span>(&#123; <span class="attr">username</span>: userinfo.<span class="property">username</span> &#125;, secretKey, &#123; <span class="attr">expiresIn</span>: <span class="string">&#x27;30s&#x27;</span> &#125;)</span><br><span class="line">  res.<span class="title function_">send</span>(&#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;登录成功！&#x27;</span>,</span><br><span class="line">    <span class="attr">token</span>: tokenStr, <span class="comment">// 要发送给客户端的 token 字符串</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这是一个有权限的 API 接口</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/admin/getinfo&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="comment">// TODO_05：使用 req.user 获取用户信息，并使用 data 属性将用户信息发送给客户端</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">user</span>)</span><br><span class="line">  res.<span class="title function_">send</span>(&#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;获取用户信息成功！&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: req.<span class="property">user</span>, <span class="comment">// 要发送给客户端的用户信息</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO_06：使用全局错误处理中间件，捕获解析 JWT 失败后产生的错误</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">err, req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 这次错误是由 token 解析失败导致的</span></span><br><span class="line">  <span class="keyword">if</span> (err.<span class="property">name</span> === <span class="string">&#x27;UnauthorizedError&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">send</span>(&#123;</span><br><span class="line">      <span class="attr">status</span>: <span class="number">401</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;无效的token&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  res.<span class="title function_">send</span>(&#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="number">500</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;未知的错误&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用 app.listen 方法，指定端口号并启动web服务器</span></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">8888</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Express server running at http://127.0.0.1:8888&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<h4 id="捕获解析JWT失败后产生的错误"><a href="#捕获解析JWT失败后产生的错误" class="headerlink" title="捕获解析JWT失败后产生的错误"></a>捕获解析JWT失败后产生的错误</h4><blockquote>
<p>当使用expressjwt 解析Token 字符串时，如果客户端发送过来的 Token 字符串过期或不合法，会产生一个解析失败的错误，影响项目的正常运行。我们可以通过 Express 的错误中间件，捕获这个错误并进行相关的处理，示例代码如下:</p>
</blockquote>

            </div>

            
                <div class="post-copyright-info">
                    <div class="article-copyright-info-container">
    <ul>
        <li>Post title：node</li>
        <li>Post author：June</li>
        <li>Create time：2023-05-03 20:59:11</li>
        <li>
            Post link：https://redefine.ohevan.com/2023/05/03/node/
        </li>
        <li>
            Copyright Notice：All articles in this blog are licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> unless stating additionally.
        </li>
    </ul>
</div>

                </div>
            

            
                <ul class="post-tags-box">
                    
                        <li class="tag-item">
                            <a href="/tags/nodeJS%E5%9F%BA%E6%9C%AC%E5%86%85%E5%AE%B9/">#nodeJS基本内容</a>&nbsp;
                        </li>
                    
                </ul>
            

            

            
                <div class="article-nav">
                    
                        <div class="article-prev">
                            <a class="prev"
                            rel="prev"
                            href="/2024/02/17/git/"
                            >
                                <span class="left arrow-icon flex-center">
                                    <i class="fa-solid fa-chevron-left"></i>
                                </span>
                                <span class="title flex-center">
                                    <span class="post-nav-title-item"></span>
                                    <span class="post-nav-item">Prev posts</span>
                                </span>
                            </a>
                        </div>
                    
                    
                        <div class="article-next">
                            <a class="next"
                            rel="next"
                            href="/2023/04/26/python-Djando/"
                            >
                                <span class="title flex-center">
                                    <span class="post-nav-title-item">python_Djando</span>
                                    <span class="post-nav-item">Next posts</span>
                                </span>
                                <span class="right arrow-icon flex-center">
                                    <i class="fa-solid fa-chevron-right"></i>
                                </span>
                            </a>
                        </div>
                    
                </div>
            


            
        </div>

        
            <div class="toc-content-container">
                <div class="post-toc-wrap">
    <div class="post-toc">
        <div class="toc-title">On this page</div>
        <div class="page-title">node</div>
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#nodeJs"><span class="nav-text">nodeJs</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9D%E8%AF%86nodeJs"><span class="nav-text">初识nodeJs</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#nodeJs%E4%B8%AD%E7%9A%84js%E8%BF%90%E8%A1%8C"><span class="nav-text">nodeJs中的js运行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#nodeJs%E5%8F%AF%E4%BB%A5%E5%81%9A%E4%BB%80%E4%B9%88"><span class="nav-text">nodeJs可以做什么</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8B%E8%BD%BDnodeJs"><span class="nav-text">下载nodeJs</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8C%BA%E5%88%86LTS%E5%92%8CCurrent%E7%89%88%E6%9C%AC%E7%9A%84%E4%B8%8D%E5%90%8C"><span class="nav-text">区分LTS和Current版本的不同</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8Bnode%E7%89%88%E6%9C%AC"><span class="nav-text">查看node版本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#nodeJ%E8%BF%90%E8%A1%8CJS%E4%BB%A3%E7%A0%81"><span class="nav-text">nodeJ运行JS代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#fs%E6%A8%A1%E5%9D%97"><span class="nav-text">fs模块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#fs-readFile"><span class="nav-text">fs.readFile</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%A4%E6%96%AD%E6%96%87%E4%BB%B6%E6%98%AF%E5%90%A6%E8%AF%BB%E5%8F%96%E6%88%90%E5%8A%9F"><span class="nav-text">判断文件是否读取成功</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#fs-writeFile"><span class="nav-text">fs.writeFile</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%A4%E6%96%AD%E6%96%87%E4%BB%B6%E6%98%AF%E5%90%A6%E8%AF%BB%E5%8F%96%E6%88%90%E5%8A%9F-1"><span class="nav-text">判断文件是否读取成功</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B4%E7%90%86%E8%80%83%E8%AF%95%E6%88%90%E7%BB%A9"><span class="nav-text">整理考试成绩</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#fs%E8%B7%AF%E5%BE%84%E5%8A%A8%E6%80%81%E6%8B%BC%E6%8E%A5%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-text">fs路径动态拼接的问题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#path%E6%A8%A1%E5%9D%97"><span class="nav-text">path模块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#path-join"><span class="nav-text">path.join()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#path-basename"><span class="nav-text">path.basename()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#path-extname"><span class="nav-text">path.extname()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#path%E8%B7%AF%E5%BE%84%E6%A1%88%E4%BE%8B"><span class="nav-text">path路径案例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="nav-text">案例的实现步骤</span></a></li></ol></li></ol></li></ol></li></ol>

    </div>
</div>
            </div>
        
    </div>
</div>


                

            </div>



        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info">
            &copy;
            
              <span>2022</span>
              -
            
            2024&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">June</a>
        </div>
        
            <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv" class="busuanzi_container_site_uv">
                        VISITOR COUNT&nbsp;<span id="busuanzi_value_site_uv" class="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="busuanzi_container_site_pv">
                        TOTAL PAGE VIEWS&nbsp;<span id="busuanzi_value_site_pv" class="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            <span class="powered-by-container">POWERED BY <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" href="https://hexo.io">Hexo</a></span>
                <br> 
            <span class="theme-version-container">THEME&nbsp;<a class="theme-version" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v1.2.1</a>
        </div>
        
        
        
            <div id="start_time_div" style="display:none">
                2022/8/17 11:45:14
            </div>
            <div>
                Blog up for <span class="odometer" id="runtime_days" ></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec
            </div>
        
        
        
            <script async data-pjax>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="right-bottom-tools page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="unfolded-tools-list">
        <li class="right-bottom-tools tool-font-adjust-plus flex-center">
            <i class="fa-regular fa-magnifying-glass-plus"></i>
        </li>

        <li class="right-bottom-tools tool-font-adjust-minus flex-center">
            <i class="fa-regular fa-magnifying-glass-minus"></i>
        </li>

        <li class="right-bottom-tools tool-expand-width flex-center">
            <i class="fa-regular fa-expand"></i>
        </li>

        <li class="right-bottom-tools tool-dark-light-toggle flex-center">
            <i class="fa-regular fa-moon"></i>
        </li>

        <!-- rss -->
        

        
            <li class="right-bottom-tools tool-scroll-to-top flex-center">
                <i class="fa-regular fa-arrow-up"></i>
            </li>
        

        <li class="right-bottom-tools tool-scroll-to-bottom flex-center">
            <i class="fa-regular fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="folded-tools-list">
        <li class="right-bottom-tools tool-toggle-show flex-center">
            <i class="fa-regular fa-cog fa-spin"></i>
        </li>
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    


</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/layouts/menu-shrink.js"></script>

<script src="/js/tools/go-top-bottom.js"></script>

<script src="/js/tools/dark-light-toggle.js"></script>





    
<script src="/js/tools/code-block.js"></script>




    
<script src="/js/layouts/lazyload.js"></script>




    
<script src="/js/tools/runtime.js"></script>

    
<script src="/js/layouts/odometer.min.js"></script>

    
<link rel="stylesheet" href="/assets/odometer-theme-minimal.css">









<div class="post-scripts pjax">
    
        
<script src="/js/tools/toc-toggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/layouts/toc.js"></script>

<script src="/js/plugins/tabs.js"></script>

    
</div>


    
<script src="/js/libs/pjax.min.js"></script>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            REDEFINE.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            REDEFINE.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            REDEFINE.refresh();
        });
    });
</script>




</body>
</html>
